var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var g=0;return function(){return g<a.length?{done:!1,value:a[g++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,h){a!=Array.prototype&&a!=Object.prototype&&(a[g]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,g){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(h){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(h||"")+"_"+g++,h)}var g=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,g){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var h=0,k={next:function(){if(h<a.length){var n=h++;return{value:g(n,a[n]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill=function(a,g,h,k){if(g){h=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var n=a[k];n in h||(h[n]={});h=h[n]}a=a[a.length-1];k=h[a];g=g(k);g!=k&&null!=g&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(a,g){var h=0,k={1:["Strongly Disagree","Disagree","Undecided","Agree","Strongly Agree"],2:["Very unsatisfied","Unsatisfied","Neutral","Satisfied","Very satisfied"],3:["Very dissatisfied","Dissatisfied","Neutral","Satisfied","Very satisfied"],4:["Pain","Neutral","No Pain"]},n={},r={},x={},H={text:1,number:2,multichoice:6,likert:12,heatmap:13},I={1:"text",2:"number",6:"multichoice",7:"likert",13:"heatmap"};a.widget("s3.surveyLayout",{options:{},_create:function(){this.id=h;h+=1;this.eventNamespace=
".surveyEditor"},_init:function(){var d=a(this.element),c=d.attr("id");c||(c="surveyEditor-widget-"+this.id);this.fieldname=c;this.recordID=d.data("id");this.data=null;this.ajaxMethod=a.searchS3!==g?a.searchS3:a.ajaxS3;a.validator.addMethod("lessThanMax",function(c,b){var d=b.id.split("-")[1];d=a("#max-"+d).val();return this.optional(b)||parseFloat(c)<=d},"needs to be lower than Maximum");a.validator.addMethod("greaterThanMin",function(c,b){var d=b.id.split("-")[1];d=a("#min-"+d).val();return this.optional(b)||
parseFloat(c)>=d},"needs to be higher than Minimum");this.refresh()},addQuestion:function(a,c,e,b){if("instructions"==e)b?this._addQuestion(a,c,e,null,!0):this._addQuestion(a,c,e);else if(b)this._addQuestion(a,c,e,b,!0);else{var d=this;b=S3.Ap.concat("/dc/question/create_json.json");var t=JSON.stringify({type:H[e],template_id:this.recordID});this.ajaxMethod({url:b,type:"POST",data:t,dataType:"json",success:function(b){d._addQuestion(a,c,e,b.question_id)},error:function(a,b,c){console.log("UNAUTHORIZED"==
c?i18n.gis_requires_login:a.responseText)}})}},_addQuestion:function(d,c,e,b,f){f||(this.data.layout[d]="instructions"==e?{type:"instructions",do:{text:""},say:{text:""}}:{type:"question",id:b},this.save());if("instructions"==e)var t='<div class="thumbnail dl-item" id="instruction-'+d+'" data-page="'+c+'"><div class="card-header"><div class="fleft">Edit</div> <div class="fleft">Display Logic</div> <div class="fleft">Translation</div> <div class="edit-bar fright"><a><i class="fa fa-copy"> </i></a><a><i class="fa fa-trash"> </i></a><i class="fa fa-arrows-v"> </i></div></div>';
else{var m=Object.keys(x).length+1;x[m]=d;t='<div class="thumbnail dl-item" id="question-'+b+'" data-page="'+c+'" data-number="'+m+'"><div class="card-header"><div class="fleft">Edit</div> <div class="fleft">Display Logic</div> <div class="fleft">Translation</div> <div class="edit-bar fright"><a><i class="fa fa-copy"> </i></a><a><i class="fa fa-trash"> </i></a><i class="fa fa-arrows-v"> </i></div></div>';var g="";f&&this.data.questions[b].mandatory&&(g=" checked");g='<div class="row"><input id="mandatory-'+
b+'" type="checkbox" '+g+' class="fleft"><label>Make question mandatory</label></div>';if("heatmap"!=e)var h='<div class="row"><label>Add graphic</label><input type="file" accept="image/png, image/jpeg" class="fleft"><label class="fleft">or pipe question image:</label><select class="fleft"><option value="">select question</option></select><a>Delete</a></div>'}switch(e){case "instructions":h=m="";f&&(m=this.data.layout[d].do.text,h=this.data.layout[d].say.text);var p='<div class="media"><h2>Data collector instructions</h2><label>What to do</label><input id="do-'+
d+'" type="text" size=100 placeholder="Type what instructor should do" value="'+m+'"><label>What to say</label><input id="say-'+d+'" type="text" size=100 placeholder="Type what instructor should say" value="'+h+'"></div>';var k="#instruction-"+d+" input";var l="#instruction-"+d+" .fa-trash";break;case "text":l="";f&&(l=this.data.questions[b].name);p='<div class="media"><h2>Text box</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+m+'</label><input id="name-'+b+'" type="text" size=100 placeholder="type question" value="'+
l+'"></div>'+g+h;k="#question-"+b+" input, #question-"+b+" select";l="#question-"+b+" .fa-trash";break;case "number":var y=p=l="";f&&(f=this.data.questions[b],l=f.name,f=f.settings||{},f=(f.requires||{}).isIntInRange)&&(p=f.min||"",y=f.max||"");p='<div class="media"><h2>Number question</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+m+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+g+h+('<div class="row"><h2>Answer</h2><form id="answer-'+
b+'"><label>Minimum:</label><input id="min-'+b+'" name="min" type="number" value="'+p+'"><label>Maximum:</label><input id="max-'+b+'" name="max" type="number" value="'+y+'"></form></div>');k="#question-"+b+" input, #question-"+b+" select";l="#question-"+b+" .fa-trash";break;case "multichoice":var C='<div class="row"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice"><i class="fa fa-minus-circle"> </i><i class="fa fa-plus-circle"> </i></div>';l="";p=C;y="";var D=" disabled",
z="",A=1,E="";if(f){f=this.data.questions[b];l=f.name;z=f.options||[];if(A=z.length){p="";for(var B=0;B<A;B++)p+='<div class="row"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice" value="'+z[B]+'"><i class="fa fa-minus-circle"> </i><i class="fa fa-plus-circle"> </i></div>'}f=f.settings;if(z=f.other||"")y=" checked",D="";A=f.multiple||1;1<A&&(E=" checked")}p='<div class="media"><h2>Multiple choice question</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+m+
'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+g+h+('<div class="row"><h2>Answer</h2><label>Choices</label></div>'+p+'<div class="row"><input id="other-'+b+'" type="checkbox"'+y+'><label>Add \'other field\'</label></div><div class="row"><label class="fleft">Field label</label><input id="other-label-'+b+'" type="text" placeholder="Other (please specify)" value="'+z+'"'+D+'></div><div class="row"><input id="multiple-'+b+'" type="checkbox"'+E+'><label>Allow multiple responses</label></div><div class="row"><label class="fleft">Maximum No. of responses:</label><i class="fa fa-minus-circle"> </i> <span id="multiple-count-'+
b+'">'+A+'</span> <i class="fa fa-plus-circle"> </i></div>');k="#question-"+b+" input, #question-"+b+" select";l="#question-"+b+" .fa-trash";break;case "likert":l="";p=['<option value="1">Agreement (Disagree - Agree)</option>','<option value="2">Satisfaction (Smiley scale)</option>','<option value="3">Satisfaction (Dissatisfied - Satisfied)</option>','<option value="4">Pain scale (3 point)</option>'];f&&(l=this.data.questions[b].name,(f=this.data.questions[b].settings)&&f.hasOwnProperty("scale")&&
(f=f.scale)&&(p[f-1]=p[f-1].replace('">','" selected>')));f=p.join();p='<div class="media"><h2>Likert-scale</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+m+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+g+h+('<div class="row"><h2>Answer</h2><label>Choices</label><select id="scale-'+b+'"><option value="">Please choose scale</option>'+f+"</select></div>");k="#question-"+b+" input, #question-"+b+" select";l="#question-"+b+" .fa-trash";
break;case "heatmap":l="",f&&(l=this.data.questions[b].name),p='<div class="media"><h2>Heatmap</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+m+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+g+('<div class="row"><h2>Image</h2><input type="file" accept="image/png, image/jpeg" class="fleft"><h3>Number of clicks allowed:</h3><i class="fa fa-minus-circle"> </i> 1 <i class="fa fa-plus-circle"> </i><h3>Tap/click regions:</h3><a class="button tiny">Add region</a><input id="region-'+
d+'-1" type="text" placeholder="enter label" disabled></div>'),k="#question-"+b+" input",l="#question-"+b+" .fa-trash"}t=t+p+"</div>";a("#survey-droppable-"+d).before(t);t=d+1;a("#survey-droppable-"+d).attr("id","survey-droppable-"+t);r[c]++;a("#section-break-"+n[c]+" > span").html("PAGE "+c+" ("+r[c]+" ELEMENTS)");var u=this.eventNamespace,v=this,F=function(){a(k).off("change"+u).on("change"+u,function(){if("instructions"==e){var c=parseInt(this.id.split("-")[1]);v.data.layout[c].do.text=a("#do-"+
c).val();v.data.layout[c].say.text=a("#say-"+c).val();v.save()}else v.saveQuestion(e,b)})};F();a(l).on("click"+u,function(){v.deleteQuestion(e,b)});switch(e){case "number":a("#answer-"+b).validate({rules:{min:{required:!1,digits:!0,lessThanMax:!0},max:{required:!1,digits:!0,greaterThanMin:!0}},messages:{min:{digits:"Only integers allowed"},max:{digits:"Only integers allowed"}},errorClass:"req",focusCleanup:!0});break;case "multichoice":var w=a("#multiple-"+b),q=a("#multiple-count-"+b),G=function(){a(".choice-"+
b).next().off("click"+u).on("click"+u,function(){if(1<a(".choice-"+b).length){a(this).parent().remove();var c=parseInt(q.html()),d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;c>d&&(q.html(d),1==d&&w.prop("checked",!1));v.saveQuestion(e,b)}else a(this).prev().val("")});a(".choice-"+b).next().next().off("click"+u).on("click"+u,function(){a(this).parent().after(C);F();G()});a("#other-"+b).on("change"+u,function(){if(a(this).prop("checked"))a("#other-label-"+b).prop("disabled",!1);else{a("#other-label-"+
b).prop("disabled",!0);var c=parseInt(q.html()),d=a(".choice-"+b).length;c>d&&(q.html(d),1==d&&w.prop("checked",!1))}});w.on("change"+u,function(){if(w.prop("checked")){parseInt(q.html());var c=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&c++;1<c?q.html(2):w.prop("checked",!1)}else q.html(1);v.saveQuestion(e,b)});q.prev().on("click"+u,function(){if(w.prop("checked")){var a=parseInt(q.html());2<a?(q.html(a-1),v.saveQuestion(e,b)):2==a&&(q.html(1),w.prop("checked",!1),v.saveQuestion(e,b))}});
q.next().on("click"+u,function(){if(w.prop("checked")){var c=parseInt(q.html()),d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;c<d&&(q.html(c+1),v.saveQuestion(e,b))}})};G()}},deleteQuestion:function(d,c){if("instructions"==d){var e=parseInt(a(this).closest(".dl-item").attr("id").split("-")[1]);var b=a("#instruction-"+e).data("page")}else e=a("#question-"+c).data("number"),e=x[e],b=a("#question-"+c).data("page");r[b]--;a("#section-break-"+n[b]+" > span").html("PAGE "+b+" ("+r[b]+" ELEMENTS)");
b+=1;for(var f=Object.keys(n).length;b<=f;b++)n[b]--;f=this.data.layout;var t=Object.keys(f).length;for(b=e;b<t;b++){var m=b+1;var g=f[m];f[b]=g;if("question"==g.type){g=g.id;var h=a("#question-"+g).data("number");"instructions"==d?x[h]=b:(m=h-1,a("#question-"+g).data("number",m),a("#qlabel-"+g).html("Q"+m),x[m]=b)}else"break"==g.type?a("#section-break-"+m).attr("id","section-break-"+b):(a("#instruction-"+m).attr("id","instruction-"+b),a("#do-"+m).attr("id","do-"+b),a("#say-"+m).attr("id","say-"+
b))}delete f[t];"instructions"!=d&&delete x[h];self.save();"instructions"==d?a("#instruction-"+e).remove():a("#question-"+c).remove();a("#survey-droppable-"+(t+1)).attr("id","survey-droppable-"+t);"instructions"!=d&&(d=S3.Ap.concat("/dc/question/")+c+"/delete.json",this.ajaxMethod({url:d,type:"POST",dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}}))},addSectionBreak:function(d,c,e){c++;n[c]=d;r[c]=0;var b='<div class="row"><div class="section-break medium-11 columns" id="section-break-'+
d+'" data-page="'+c+'"><span>PAGE '+c+' (0 ELEMENTS)</span></div><div class="medium-1 columns">'+(d?'<i class="fa fa-times-circle"> </i>':"")+'<i class="fa fa-chevron-circle-down"> </i></div></div>';if(d){a("#survey-droppable-"+d).before(b);b=d+1;a("#survey-droppable-"+d).data("page",c).attr("id","survey-droppable-"+b);e||(this.data.layout[d]={type:"break"},this.save());var f=this;c=this.eventNamespace;a("#section-break-"+d).next().children(".fa-times-circle").on("click"+c,function(){var b=parseInt(a(this).parent().prev().attr("id").split("-")[2]);
f.deleteSectionBreak(b)})}else a(this.element).parent().append(b)},deleteSectionBreak:function(d){var c=a("#section-break-"+d).data("page"),e=r[c];if(e){var b=c-1;r[b]+=e;a("#section-break-"+n[b]+" > span").html("PAGE "+b+" ("+r[b]+" ELEMENTS)")}for(e=Object.keys(n).length;c<e;c++)n[c]=n[c+1]-1,r[c]=r[c+1];delete n[e];delete r[e];b=this.data.layout;var f=Object.keys(b).length;if(d!=f)for(c=d;c<f;c++){var g=c+1;var h=b[g];b[c]=h;"question"==h.type?(g=a("#question-"+h.id).data("number"),x[g]=c):"break"==
h.type?(h=a("#section-break-"+g).data("page")-1,a("#section-break-"+g).data("page",h),a("#section-break-"+g+" > span").html("PAGE "+h+" ("+r[h]+" ELEMENTS)"),a("#section-break-"+g).attr("id","section-break-"+c)):(a("#instruction-"+g).attr("id","instruction-"+c),a("#do-"+g).attr("id","do-"+c),a("#say-"+g).attr("id","say-"+c))}delete b[f];this.save();a("#section-break-"+d).parent().remove();a("#survey-droppable-"+(f+1)).data("page",e-1).attr("id","survey-droppable-"+f)},droppable:function(d,c){var e=
this;c='<div class="survey-droppable" id="survey-droppable-'+d+'" data-page="'+c+'"><span>Drag and drop questions here</span></div>';a(this.element).parent().append(c);a("#survey-droppable-"+d).droppable({drop:function(b,c){b=c.draggable[0].id;c=parseInt(this.id.split("-")[2]);var d=a(this).data("page");"break"==b?e.addSectionBreak(c,d):e.addQuestion(c,d,b)}})},_destroy:function(){a.Widget.prototype.destroy.call(this)},loadSurvey:function(){var a=this.data.layout;if(a)for(var c,e=1,b=this.data.questions,
f=1,g=Object.keys(a).length;f<=g;f++)c=a[f],"break"==c.type?(this.addSectionBreak(f,e,!0),e++):"instructions"==c.type?this.addQuestion(f,e,"instructions",!0):(c=c.id,this.addQuestion(f,e,I[b[c].type],c))},reload:function(){var a=this,c=S3.Ap.concat("/dc/template/")+this.recordID+".json";this.ajaxMethod({url:c,type:"GET",dataType:"json",success:function(c){a.input.val(JSON.stringify(c));a.data=c;a.refresh()},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})},
refresh:function(){this._unbindEvents();this._deserialize();this.addSectionBreak(0,0);this.droppable(1,1);this.loadSurvey()},saveQuestion:function(d,c){var e=a("#name-"+c).val();if(e){var b=S3.Ap.concat("/dc/question/")+c+"/update_json.json";e={name:e,mandatory:a("#mandatory-"+c).prop("checked")};switch(d){case "number":a("#min-"+c).hasClass("req")?d=null:(d=a("#min-"+c).val())&&(d=parseInt(d));a("#max-"+c).hasClass("req")?c=null:(c=a("#max-"+c).val())&&(c=parseInt(c));e.settings={requires:{isIntInRange:{min:d,
max:c}}};break;case "multichoice":var f=[];a(".choice-"+c).each(function(){f.push(a(this).val())});e.options=f;d={};a("#other-"+c).prop("checked")?d.other=a("#other-label-"+c).val():d.other=null;a("#multiple-"+c).prop("checked")?d.multiple=parseInt(a("#multiple-count-"+c).html()):d.multiple=1;e.settings=d;break;case "likert":(c=a("#scale-"+c).val())?(e.options=k[c],e.settings={scale:c}):(e.options=[],e.settings={scale:null})}this.ajaxMethod({url:b,type:"POST",data:JSON.stringify(e),dataType:"json",
success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},save:function(){var a=S3.Ap.concat("/dc/template/")+this.recordID+"/update_json.json";this.ajaxMethod({url:a,type:"POST",data:JSON.stringify({layout:this.data.layout}),dataType:"json",success:function(){},error:function(a,d,b){console.log("UNAUTHORIZED"==b?i18n.gis_requires_login:a.responseText)}})},_serialize:function(){var d=JSON.stringify(this.data);a(this.element).val(d);return d},
_deserialize:function(){var d=a(this.element).val()||"{}";return this.data=JSON.parse(d)},_bindEvents:function(){},_unbindEvents:function(){var d=this.eventNamespace;a(this.element).unbind(d);return!0}})})(jQuery);
