var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var n=0;return function(){return n<a.length?{done:!1,value:a[n++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,n,h){a!=Array.prototype&&a!=Object.prototype&&(a[n]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,n){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:n})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(h){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(h||"")+"_"+n++,h)}var n=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,n){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var h=0,m={next:function(){if(h<a.length){var x=h++;return{value:n(x,a[x]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill=function(a,n,h,m){if(n){h=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var x=a[m];x in h||(h[x]={});h=h[x]}a=a[a.length-1];m=h[a];n=n(m);n!=m&&null!=n&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(a){a(window.jQuery,window.loadImage)})(function(a,n){var h=0,m=[],x={1:["Strongly Disagree","Disagree","Undecided","Agree","Strongly Agree"],2:["Very unsatisfied","Unsatisfied","Neutral","Satisfied","Very satisfied"],3:["Very dissatisfied","Dissatisfied","Neutral","Satisfied","Very satisfied"],4:["Pain","Neutral","No Pain"]},A={},p={},B={},O={text:1,number:2,multichoice:6,likert:12,heatmap:13},I={1:"text",2:"number",6:"multichoice",12:"likert",13:"heatmap"};a.widget("s3.surveyLayout",{options:{},
_create:function(){this.id=h;h+=1;this.eventNamespace=".surveyEditor"},_init:function(){var d=a(this.element),c=d.attr("id");c||(c="surveyEditor-widget-"+this.id);this.fieldname=c;this.recordID=d.data("id");this.data=null;this.ajaxMethod=void 0!==a.searchS3?a.searchS3:a.ajaxS3;a.validator.addMethod("lessThanMax",function(c,b){var d=b.id.split("-")[1];d=a("#max-"+d).val();return this.optional(b)||parseFloat(c)<=d},"needs to be lower than Maximum");a.validator.addMethod("greaterThanMin",function(c,
b){var d=b.id.split("-")[1];d=a("#min-"+d).val();return this.optional(b)||parseFloat(c)>=d},"needs to be higher than Minimum");this.refresh()},addQuestion:function(a,c,f,b){if("instructions"==f)b?this._addQuestion(a,c,f,null,!0):this._addQuestion(a,c,f);else if(b)this._addQuestion(a,c,f,b,!0);else{var d=this;b=S3.Ap.concat("/dc/question/create_json.json");var k=JSON.stringify({type:O[f],template_id:this.recordID});this.ajaxMethod({url:b,type:"POST",data:k,dataType:"json",success:function(b){d._addQuestion(a,
c,f,b.question_id)},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},_addQuestion:function(d,c,f,b,g){var k=this.data.l10n;if(g)for(var e=1,C=Object.keys(B).length;e<=C;e++){if(d==B[e]){var y=e;break}}else"instructions"==f?this.data.layout[d]={type:"instructions",do:{text:""},say:{text:""}}:(y=Object.keys(B).length+1,B[y]=d,this.data.layout[d]={type:"question",id:b}),this.saveLayout();var l;C="";k&&(C='<li class="tab-title"><a href="#translation-'+d+
'">Translation</a></li>');if("instructions"==f){var h="instruction-"+d;var H=""}else{h="question-"+b;H=' data-number="'+y+'"';var t=this.data.questions[b];var z="";g&&t.mandatory&&(z=" checked");z='<div class="row"><input id="mandatory-'+b+'" type="checkbox" '+z+' class="fleft"><label>Make question mandatory</label></div>';if("heatmap"!=f){e=this.pipeOptionsHtml(b,g);var F='<div class="row"><label>Add image</label><span id="preview-'+b+'" class="preview-empty fleft"></span><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+
b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><label class="fleft">or pipe question image:</label><select id="pipe-'+b+'" class="fleft">'+e+'</select><a id="image-delete-'+b+'">Delete</a></div>'}}h='<div class="thumbnail dl-item" id="'+h+'" data-page="'+c+'"'+H+'><div class="card-header"><ul class="tabs fleft" data-tab><li class="tab-title active"><a href="#edit-'+d+'">Edit</a></li><li class="tab-title"><a href="#logic-'+d+'">Display Logic</a></li> '+C+'</ul><div class="edit-bar fright"><a><i class="ucce ucce-duplicate"> </i></a><a><i class="ucce ucce-delete"> </i></a><i class="ucce ucce-up"> </i><i class="ucce ucce-down"> </i></div></div><div class="tabs-content">';
e=this.logicOptionsHtml(b,g);H='<div class="media content" id="logic-'+d+'"><h2>Only display question if...</h2><select id="logic-select-'+b+'" class="fleft">'+e+"</select><label>response is</label></div>";switch(f){case "instructions":F=l=y=z="";g&&(e=this.data.layout[d],z=e.do.text,l=e.say.text,k&&e.do.l10n&&(y=e.do.l10n[k],F=e.say.l10n[k]));l='<div class="media content active" id="edit-'+d+'"><h2>Data collector instructions</h2><label>What to do</label><input id="do-'+d+'" type="text" size=100 placeholder="Type what instructor should do" value="'+
z+'"><label>What to say</label><input id="say-'+d+'" type="text" size=100 placeholder="Type what instructor should say" value="'+l+'"></div>';var r='<div class="media content" id="translation-'+d+'"><h2>Data collector instructions</h2><label>What to do</label><input id="do-l10n-'+d+'" type="text" size=100 placeholder="Type translation of what instructor should do" value="'+y+'"><label>What to say</label><input id="say-l10n-'+d+'" type="text" size=100 placeholder="Type translation of what instructor should say" value="'+
F+'"></div>';var G="#instruction-"+d+" input";var q="#instruction-"+d+" .ucce-delete";break;case "text":l="";g&&(l=t.name);l='<div class="media content active" id="edit-'+d+'"><h2>Text box</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+y+'</label><input id="name-'+b+'" type="text" size=100 placeholder="type question" value="'+l+'"></div>'+z+F+"</div>";r='<div class="media content" id="translation-'+d+'"><h2>Text box</h2><div class="row"><label id="qlabel-l10n-'+b+'" class="fleft">Q'+
y+'</label><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value=""></div></div>';G="#question-"+b+" input, #question-"+b+" select";q="#question-"+b+" .ucce-delete";break;case "number":r=q=l="";g&&(l=t.name,e=t.settings||{},e=(e.requires||{}).isIntInRange)&&(q=e.min||"",r=e.max||"");l='<div class="media content active" id="edit-'+d+'"><h2>Number question</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+y+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+
l+'"></div>'+z+F+'<div class="row"><h2>Answer</h2><form id="answer-'+b+'"><label>Minimum:</label><input id="min-'+b+'" name="min" type="number" value="'+q+'"><label>Maximum:</label><input id="max-'+b+'" name="max" type="number" value="'+r+'"></form></div>';r='<div class="media content" id="translation-'+d+'"></div';G="#question-"+b+" input, #question-"+b+" select";q="#question-"+b+" .ucce-delete";break;case "multichoice":var J='<div class="row"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div>';
l="";q=J;r="";C=" disabled";var D="";e=1;var K="";if(g){l=t.name;D=t.options||[];var L=D.length;if(L)for(q="",e=0;e<L;e++)q+='<div class="row"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice" value="'+D[e]+'"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div>';e=t.settings;if(D=e.other||"")r=" checked",C="";e=e.multiple||1;1<e&&(K=" checked")}l='<div class="media content active" id="edit-'+d+'"><h2>Multiple choice question</h2><div class="row"><label id="qlabel-'+
b+'" class="fleft">Q'+y+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+z+F+'<div class="row"><h2>Answer</h2><label>Choices</label></div>'+q+'<div class="row"><input id="other-'+b+'" type="checkbox"'+r+'><label>Add \'other field\'</label></div><div class="row"><label class="fleft">Field label</label><input id="other-label-'+b+'" type="text" placeholder="Other (please specify)" value="'+D+'"'+C+'></div><div class="row"><input id="multiple-'+b+'" type="checkbox"'+
K+'><label>Allow multiple responses</label></div><div class="row"><label class="fleft">Maximum No. of responses:</label><i class="ucce ucce-minus"> </i> <span id="multiple-count-'+b+'">'+e+'</span> <i class="ucce ucce-plus"> </i></div>';r='<div class="media content" id="translation-'+d+'"></div';G="#question-"+b+" input, #question-"+b+" select";q="#question-"+b+" .ucce-delete";break;case "likert":q=l="";r=['<option value="1">Agreement (Disagree - Agree)</option>','<option value="2">Satisfaction (Smiley scale)</option>',
'<option value="3">Satisfaction (Dissatisfied - Satisfied)</option>','<option value="4">Pain scale (3 point)</option>'];if(g&&(l=t.name,(e=t.settings)&&e.hasOwnProperty("scale")&&(e=e.scale))){r[e-1]=r[e-1].replace('">','" selected>');D=x[e];q+="<ul>";e=0;for(C=D.length;e<C;e++)q+="<li>"+D[e]+"</li>";q+="</ul>"}e=r.join();l='<div class="media content active" id="edit-'+d+'"><h2>Likert-scale</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+y+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+
l+'"></div>'+z+F+'<div class="row"><h2>Answer</h2><label>Choices</label><select id="scale-'+b+'"><option value="">Please choose scale</option>'+e+'</select></div><div class="row">'+q+"</div>";r='<div class="media content" id="translation-'+d+'"></div';G="#question-"+b+" input, #question-"+b+" select";q="#question-"+b+" .ucce-delete";break;case "heatmap":l="",g&&(l=t.name),l='<div class="media content active" id="edit-'+d+'"><h2>Heatmap</h2><div class="row"><label id="qlabel-'+b+'" class="fleft">Q'+
y+'</label><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+l+'"></div>'+z+('<div class="row"><h2>Image</h2><span id="preview-'+b+'" class="preview-empty fleft"></span><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><h3>Number of clicks allowed:</h3><i class="ucce ucce-minus"> </i> 1 <i class="ucce ucce-plus"> </i><h3>Tap/click regions:</h3><a class="button tiny">Add region</a><input id="region-'+
d+'-1" type="text" placeholder="enter label" disabled></div>'),r='<div class="media content" id="translation-'+d+'"></div',G="#question-"+b+" input",q="#question-"+b+" .ucce-delete"}h=h+l+H;k&&(h+=r);h+="</div></div>";a("#survey-droppable-"+d).before(h);h=d+1;a("#survey-droppable-"+d).attr("id","survey-droppable-"+h);p[c]++;a("#section-break-"+A[c]+" > span").html("PAGE "+c+" ("+p[c]+" ELEMENTS)");var v=this.eventNamespace,u=this,M=function(){a(G).off("change"+v).on("change"+v,function(){if("instructions"==
f){var c=this.id.split("-");c=parseInt(c[c.length-1]);var d=u.data.layout[c];d.do.text=a("#do-"+c).val();d.say.text=a("#say-"+c).val();k&&(d.do.hasOwnProperty("10n")||(d.do.l10n={}),d.do.l10n[k]=a("#do-l10n-"+c).val(),d.say.hasOwnProperty("10n")||(d.say.l10n={}),d.say.l10n[k]=a("#say-l10n-"+c).val());u.saveLayout()}else u.saveQuestion(f,b)});if("instructions"!=f&&"heatmap"!=f)a("#pipe-"+b).on("change"+v,function(){var c=a(this).val();if(c){for(var d,e=0,g=m.length;e<g;e++)if(d=m[e],d.label==c){t.settings.pipeImage=
{id:d.id,region:d.region};break}u.deleteImage(b)}else delete t.settings.pipeImage;u.saveQuestion(f,b)})};M();"instructions"!=f&&(g&&(c=t.file)&&n(S3.Ap.concat("/default/download/"+c),function(c){var d=n.scale(c,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(d);return c},{}),a("#image-delete-"+b).on("click"+v,function(){u.deleteImage(b)}),a("#image-"+b).fileupload({dataType:"json",dropZone:a("#preview-"+b+", #image-"+b),maxNumberOfFiles:1,url:S3.Ap.concat("/dc/question/")+
b+"/image_upload.json",add:function(c,d){if(c.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&a(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit();n(d.files[0],function(c){var d=n.scale(c,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(d);d=t.type;if(13!=d){t.settings.hasOwnProperty("pipeImage")&&a("#pipe-"+b).val("").trigger("change");var e=!1;for(c in m)c.id==b&&(e=!0);e||(d="Q"+a("#question-"+b).data("number")+
" "+I[d],m.push({label:d,id:b}));d=u.data.questions;e=u.data.layout;for(var f=1;f<=Object.keys(e).length;f++){var g=e[f];if("question"==g.type){g=g.id;var k=d[g];13!=k.type&&a("#pipe-"+g).empty().append(u.pipeOptionsHtml(g))}}}return c},{})})}}));a(q).on("click"+v,function(){u.deleteQuestion(f,b,this)});switch(f){case "number":a("#answer-"+b).validate({rules:{min:{required:!1,digits:!0,lessThanMax:!0},max:{required:!1,digits:!0,greaterThanMin:!0}},messages:{min:{digits:"Only integers allowed"},max:{digits:"Only integers allowed"}},
errorClass:"req",focusCleanup:!0});break;case "multichoice":var E=a("#multiple-"+b),w=a("#multiple-count-"+b),N=function(){a(".choice-"+b).next().off("click"+v).on("click"+v,function(){if(1<a(".choice-"+b).length){a(this).parent().remove();var c=parseInt(w.html()),d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;c>d&&(w.html(d),1==d&&E.prop("checked",!1));u.saveQuestion(f,b)}else a(this).prev().val("")});a(".choice-"+b).next().next().off("click"+v).on("click"+v,function(){a(this).parent().after(J);
M();N()});a("#other-"+b).on("change"+v,function(){if(a(this).prop("checked"))a("#other-label-"+b).prop("disabled",!1);else{a("#other-label-"+b).prop("disabled",!0);var c=parseInt(w.html()),d=a(".choice-"+b).length;c>d&&(w.html(d),1==d&&E.prop("checked",!1))}});E.on("change"+v,function(){if(E.prop("checked")){parseInt(w.html());var c=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&c++;1<c?w.html(2):E.prop("checked",!1)}else w.html(1);u.saveQuestion(f,b)});w.prev().on("click"+v,function(){if(E.prop("checked")){var a=
parseInt(w.html());2<a?(w.html(a-1),u.saveQuestion(f,b)):2==a&&(w.html(1),E.prop("checked",!1),u.saveQuestion(f,b))}});w.next().on("click"+v,function(){if(E.prop("checked")){var c=parseInt(w.html()),d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;c<d&&(w.html(c+1),u.saveQuestion(f,b))}})};N();break;case "likert":a("#scale-"+b).on("change"+v,function(){var b=a(this),c=b.val();if(c){c=x[c];for(var d="",e=0,f=c.length;e<f;e++)d+="<li>"+c[e]+"</li>";c="<ul>"+d+"</ul>";b.parent().next().empty().append(c)}else b.parent().next().empty()})}"instructions"==
f?a("#instruction-"+d).foundation():a("#question-"+b).foundation()},deleteQuestion:function(d,c,f){if("instructions"==d){f=parseInt(a(f).closest(".dl-item").attr("id").split("-")[1]);var b=a("#instruction-"+f).data("page")}else f=a("#question-"+c).data("number"),f=B[f],b=a("#question-"+c).data("page");p[b]--;a("#section-break-"+A[b]+" > span").html("PAGE "+b+" ("+p[b]+" ELEMENTS)");b+=1;for(var g=Object.keys(A).length;b<=g;b++)A[b]--;g=this.data.layout;var k=Object.keys(g).length;for(b=f;b<k;b++){var e=
b+1;var h=g[e];g[b]=h;if("question"==h.type){h=h.id;var m=a("#question-"+h).data("number");"instructions"==d?B[m]=b:(e=m-1,a("#question-"+h).data("number",e),a("#qlabel-"+h).html("Q"+e),B[e]=b)}else"break"==h.type?a("#section-break-"+e).attr("id","section-break-"+b):(a("#instruction-"+e).attr("id","instruction-"+b),a("#do-"+e).attr("id","do-"+b),a("#say-"+e).attr("id","say-"+b),a("#do-l10n-"+e).attr("id","do-l10n-"+b),a("#say-l10n-"+e).attr("id","say-l10n-"+b))}delete g[k];"instructions"!=d&&delete B[m];
this.saveLayout();"instructions"==d?a("#instruction-"+f).remove():a("#question-"+c).remove();a("#survey-droppable-"+(k+1)).attr("id","survey-droppable-"+k);"instructions"!=d&&(d=S3.Ap.concat("/dc/question/")+c+"/delete.json",this.ajaxMethod({url:d,type:"POST",dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}}))},pipeOptionsHtml:function(a,c){var d=this.data.questions[a];c='<option value="">select question</option>';if(d&&
d.settings&&d.settings.pipeImage)var b=d.settings.pipeImage;for(var g=0,k=m.length;g<k;g++)d=m[g],d.id!=a&&(c=b&&b.id==d.id&&b.region==d.region?c+("<option selected>"+d.label+"</option>"):c+("<option>"+d.label+"</option>"));return c},logicOptionsHtml:function(a,c){return'<option value="">select question</option>'},deleteImage:function(d){var c=this,f=a("#preview-"+d);if(!f.hasClass("preview-empty")){var b=S3.Ap.concat("/dc/question/")+d+"/image_delete.json";this.ajaxMethod({url:b,type:"POST",dataType:"json",
success:function(){f.empty().addClass("preview-empty");var b=m;m=[];for(var k=0,e=b.length;k<e;k++){var h=b[k];h.id!=d&&m.push(h)}h=c.data.questions;b=c.data.layout;for(k=1;k<=Object.keys(b).length;k++)if(e=b[k],"question"==e.type){e=e.id;var n=h[e];13!=n.type&&a("#pipe-"+e).empty().append(c.pipeOptionsHtml(e))}},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},addSectionBreak:function(d,c,f){c++;A[c]=d;p[c]=0;var b='<div class="row"><div class="section-break medium-11 columns" id="section-break-'+
d+'" data-page="'+c+'"><span>PAGE '+c+' (0 ELEMENTS)</span></div><div class="medium-1 columns">'+(d?'<i class="ucce ucce-delete-page"> </i>':"")+'<i class="ucce ucce-down-alt"> </i></div></div>';if(d){a("#survey-droppable-"+d).before(b);b=d+1;a("#survey-droppable-"+d).data("page",c).attr("id","survey-droppable-"+b);f||(this.data.layout[d]={type:"break"},this.saveLayout());var g=this;c=this.eventNamespace;a("#section-break-"+d).next().children(".ucce-delete-page").on("click"+c,function(){var b=parseInt(a(this).parent().prev().attr("id").split("-")[2]);
g.deleteSectionBreak(b)})}else a(this.element).parent().append(b)},deleteSectionBreak:function(d){var c=a("#section-break-"+d).data("page"),f=p[c];if(f){var b=c-1;p[b]+=f;a("#section-break-"+A[b]+" > span").html("PAGE "+b+" ("+p[b]+" ELEMENTS)")}for(f=Object.keys(A).length;c<f;c++)A[c]=A[c+1]-1,p[c]=p[c+1];delete A[f];delete p[f];b=this.data.layout;var g=Object.keys(b).length;if(d!=g)for(c=d;c<g;c++){var k=c+1;var e=b[k];b[c]=e;"question"==e.type?(k=a("#question-"+e.id).data("number"),B[k]=c):"break"==
e.type?(e=a("#section-break-"+k).data("page")-1,a("#section-break-"+k).data("page",e),a("#section-break-"+k+" > span").html("PAGE "+e+" ("+p[e]+" ELEMENTS)"),a("#section-break-"+k).attr("id","section-break-"+c)):(a("#instruction-"+k).attr("id","instruction-"+c),a("#do-"+k).attr("id","do-"+c),a("#say-"+k).attr("id","say-"+c))}delete b[g];this.saveLayout();a("#section-break-"+d).parent().remove();a("#survey-droppable-"+(g+1)).data("page",f-1).attr("id","survey-droppable-"+g)},droppable:function(d,c){var f=
this;c='<div class="survey-droppable" id="survey-droppable-'+d+'" data-page="'+c+'"><span>Drag and drop questions here</span></div>';a(this.element).parent().append(c);a("#survey-droppable-"+d).droppable({drop:function(b,c){b=c.draggable[0].id;c=parseInt(this.id.split("-")[2]);var d=a(this).data("page");"break"==b?f.addSectionBreak(c,d):f.addQuestion(c,d,b)}})},_destroy:function(){a.Widget.prototype.destroy.call(this)},loadSurvey:function(){var a=this.data.layout;if(a){for(var c,f=1,b=0,g,k,e,h=this.data.questions,
n=Object.keys(a).length,l=1;l<=n;l++)if(c=a[l],"break"!=c.type&&"instructions"!=c.type&&(b++,B[b]=l,c=c.id,g=h[c],g.file))if(13==g.type){if(g=g.settings.regions){k="Q"+b+" Heatmap; ";for(var p=0,x=g.length;p<x;p++)e=k+"'"+g[p].label+"'",m.push({label:e,id:c,region:p})}}else e="Q"+b+" "+I[g.type],m.push({label:e,id:c});for(l=1;l<=n;l++)c=a[l],"break"==c.type?(this.addSectionBreak(l,f,!0),f++):"instructions"==c.type?this.addQuestion(l,f,"instructions",!0):(c=c.id,this.addQuestion(l,f,I[h[c].type],c))}},
refresh:function(){this._deserialize();this.addSectionBreak(0,0);this.droppable(1,1);this.loadSurvey()},saveQuestion:function(d,c){var f=a("#name-"+c).val();if(f){var b=S3.Ap.concat("/dc/question/")+c+"/update_json.json",g={};f={name:f,mandatory:a("#mandatory-"+c).prop("checked")};var h=this.data.questions[c].settings.pipeImage;h&&(g.pipeImage=h);switch(d){case "number":a("#min-"+c).hasClass("req")?d=null:(d=a("#min-"+c).val())&&(d=parseInt(d));a("#max-"+c).hasClass("req")?c=null:(c=a("#max-"+c).val())&&
(c=parseInt(c));g.requires={isIntInRange:{min:d,max:c}};break;case "multichoice":var e=[];a(".choice-"+c).each(function(){e.push(a(this).val())});f.options=e;a("#other-"+c).prop("checked")?g.other=a("#other-label-"+c).val():g.other=null;a("#multiple-"+c).prop("checked")?g.multiple=parseInt(a("#multiple-count-"+c).html()):g.multiple=1;break;case "likert":(c=a("#scale-"+c).val())?(f.options=x[c],g.scale=c):(f.options=[],g.scale=null)}f.settings=g;this.ajaxMethod({url:b,type:"POST",data:JSON.stringify(f),
dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},saveLayout:function(){var a=S3.Ap.concat("/dc/template/")+this.recordID+"/update_json.json";this.ajaxMethod({url:a,type:"POST",data:JSON.stringify({layout:this.data.layout}),dataType:"json",success:function(){},error:function(a,d,b){console.log("UNAUTHORIZED"==b?i18n.gis_requires_login:a.responseText)}})},_deserialize:function(){var d=a(this.element).val()||"{}";return this.data=
JSON.parse(d)}})});
