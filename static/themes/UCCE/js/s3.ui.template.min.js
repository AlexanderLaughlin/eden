var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var t=0;return function(){return t<a.length?{done:!1,value:a[t++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,t,p){a!=Array.prototype&&a!=Object.prototype&&(a[t]=p.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,t){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(p){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(p||"")+"_"+t++,p)}var t=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,t){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var p=0,q={next:function(){if(p<a.length){var w=p++;return{value:t(w,a[w]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill=function(a,t,p,q){if(t){p=$jscomp.global;a=a.split(".");for(q=0;q<a.length-1;q++){var w=a[q];w in p||(p[w]={});p=p[w]}a=a[a.length-1];q=p[a];t=t(q);t!=q&&null!=t&&$jscomp.defineProperty(p,a,{configurable:!0,writable:!0,value:t})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,t,p){a instanceof String&&(a=String(a));for(var q=a.length,w=0;w<q;w++){var A=a[w];if(t.call(p,A,w,a))return{i:w,v:A}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,p){return $jscomp.findInternal(this,a,p).v}},"es6","es3");
(function(a){a(window.jQuery,window.loadImage)})(function(a,t){var p=0,q=[],w={1:["Strongly Disagree","Disagree","Undecided","Agree","Strongly Agree"],2:["Very unsatisfied","Unsatisfied","Neutral","Satisfied","Very satisfied"],3:["Very dissatisfied","Dissatisfied","Neutral","Satisfied","Very satisfied"],4:["Pain","Neutral","No Pain"]},A={},B={},D={},K={text:1,number:2,multichoice:6,likert:12,heatmap:13},J={1:"text",2:"number",6:"multichoice",12:"likert",13:"heatmap"};a.widget("s3.surveyLayout",{options:{},
_create:function(){this.id=p;p+=1;this.eventNamespace=".surveyEditor"},_init:function(){var c=a(this.element),e=c.attr("id");e||(e="surveyEditor-widget-"+this.id);this.fieldname=e;this.recordID=c.data("id");this.data=null;this.ajaxMethod=void 0!==a.searchS3?a.searchS3:a.ajaxS3;a.validator.addMethod("lessThanMax",function(c,b){var d=b.id.split("-")[1];d=a("#max-"+d).val();return""==d?this.optional(b)||!0:this.optional(b)||parseFloat(c)<=d},"needs to be lower than Maximum");a.validator.addMethod("greaterThanMin",
function(c,b){var d=b.id.split("-")[1];d=a("#min-"+d).val();return""==d?this.optional(b)||!0:this.optional(b)||parseFloat(c)>=d},"needs to be higher than Minimum");this.refresh()},addQuestion:function(a,e,f,b){if("instructions"==f)b?this._addQuestion(a,e,f,null,!0):this._addQuestion(a,e,f);else if(b)this._addQuestion(a,e,f,b,!0);else{var d=this;b=S3.Ap.concat("/dc/question/create_json.json");var c=JSON.stringify({type:K[f],template_id:this.recordID});this.ajaxMethod({url:b,type:"POST",data:c,dataType:"json",
success:function(b){d._addQuestion(a,e,f,b.question_id)},error:function(a,b,d){console.log("UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText)}})}},_addQuestion:function(c,e,f,b,d){var h=this.data.l10n;if(d)for(var g=1,l=Object.keys(D).length;g<=l;g++){if(c==D[g]){var k=g;break}}else"instructions"==f?this.data.layout[c]={type:"instructions",do:{text:""},say:{text:""}}:(k=Object.keys(D).length+1,D[k]=c,this.data.layout[c]={type:"question",id:b},this.data.questions[b]={type:K[f],settings:{}}),
this.saveLayout();var m="";var n;h||(m=" hide");l='<li class="tab-title l10n'+m+'"><a href="#translation-'+c+'">Translation</a></li>';if("instructions"==f){m="instruction-"+c;var p=""}else{m="question-"+b;p=' data-number="'+k+'"';var C="";var u=this.data.questions[b];d&&u.mandatory&&(C=" checked");C='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="mandatory-'+b+'" type="checkbox" '+C+' class="fleft"><label>Make question mandatory</label></div></div>';
if("heatmap"!=f){g=this.pipeOptionsHtml(b,d);var G='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Add image</label><span id="preview-'+b+'" class="preview-empty fleft"></span><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><label class="fleft">or pipe question image:</label><select id="pipe-'+b+'" class="fleft">'+g+'</select><a id="image-delete-'+
b+'">Delete</a></div></div>'}}m='<div class="thumbnail dl-item" id="'+m+'" data-page="'+e+'"'+p+'><div class="card-header"><ul class="tabs fleft" data-tab><li class="tab-title active"><a href="#edit-'+c+'">Edit</a></li><li class="tab-title"><a href="#logic-'+c+'">Display logic</a></li> '+l+'</ul><div class="edit-bar fright"><a><i class="ucce ucce-duplicate"> </i></a><a><i class="ucce ucce-delete"> </i></a><i class="ucce ucce-up"> </i><i class="ucce ucce-down"> </i></div></div><div class="tabs-content">';
g=this.logicOptionsHtml(b,d);p='<div class="media content" id="logic-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Only display question if...</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><select id="logic-select-'+b+'" class="fleft">'+g+"</select><label>response is</label></div></div></div>";switch(f){case "instructions":G=n=k=C="";if(d){var r=this.data.layout[c];C=r.do.text;n=r.say.text;
h&&r.do.l10n&&(k=r.do.l10n[h],G=r.say.l10n[h])}r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Data collector instructions</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>What instructor should do</label><input id="do-'+c+'" type="text" size=100 placeholder="Type what instructor should do" value="'+C+'"><label>What instructor should say</label><input id="say-'+
c+'" type="text" size=100 placeholder="Type what instructor should say" value="'+n+'"></div></div></div>';var v='<div class="media content" id="translation-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Data collector instructions</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>What instructor should do</label><div class="translate-from"></div><input id="do-l10n-'+c+'" type="text" size=100 placeholder="Type translation..." value="'+
k+'"><label>What instructor should say</label><div class="translate-from"></div><input id="say-l10n-'+c+'" type="text" size=100 placeholder="Type translation..." value="'+G+'"></div></div></div>';var H="#instruction-"+c+" input";n="#instruction-"+c+" .ucce-delete";break;case "text":n=r="";d&&(r=u.name,h&&(n=u.name_l10n||""));r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Text box</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+
b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><input id="name-'+b+'" type="text" size=100 placeholder="type question" value="'+r+'"></div></div>'+C+G+"</div>";v='<div class="media content" id="translation-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Text box</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><div class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+
b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>';H="#question-"+b+" input, #question-"+b+" select";n="#question-"+b+" .ucce-delete";break;case "number":l=v=n=r="";d&&(r=u.name,h&&(n=u.name_l10n||""),g=u.settings||{},g=(g.requires||{}).isIntInRange)&&(v=g.min||"",l=g.max||"");r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Number question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+
b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+r+'"></div></div>'+C+G+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Restrict input to:</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><form id="answer-'+
b+'"><label class="fleft">Minimum:</label><input id="min-'+b+'" name="min" type="number" value="'+v+'" class="fleft"><label class="fleft">Maximum:</label><input id="max-'+b+'" name="max" type="number" value="'+l+'" class="fleft"></form></div></div></div>';v='<div class="media content" id="translation-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Number question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+
b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><div class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>';H="#question-"+b+" input, #question-"+b+" select";n="#question-"+b+" .ucce-delete";break;case "multichoice":var L='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input class="choice-'+
b+'" type="text" placeholder="Enter an answer choice"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div></div>';n=r="";v=L;l="";var I=" disabled",E="";g=1;var M="";if(d){r=u.name;h&&(n=u.name_l10n||"");E=u.options||[];var N=E.length;if(N)for(v="",g=0;g<N;g++)v+='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice" value="'+E[g]+'"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div></div>';
g=u.settings;if(E=g.other||"")l=" checked",I="";g=g.multiple||1;1<g&&(M=" checked")}r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Multiple choice question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+r+'"></div></div>'+
C+G+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Choices</label></div></div>'+v+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="other-'+b+'" type="checkbox"'+l+'><label>Add \'other field\'</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label class="fleft">Field label</label><input id="other-label-'+
b+'" type="text" placeholder="Other (please specify)" value="'+E+'"'+I+'></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="multiple-'+b+'" type="checkbox"'+M+'><label>Allow multiple responses</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label class="fleft">Maximum No. of responses:</label><i class="ucce ucce-minus"> </i> <span id="multiple-count-'+b+'">'+g+'</span> <i class="ucce ucce-plus"> </i></div></div></div>';
v='<div class="media content" id="translation-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Multiple choice question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><div class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+
n+'"></div></div></div>';H="#question-"+b+" input, #question-"+b+" select";n="#question-"+b+" .ucce-delete";break;case "likert":v=n=r="";I=['<option value="1">Agreement (Disagree - Agree)</option>','<option value="2">Satisfaction (Smiley scale)</option>','<option value="3">Satisfaction (Dissatisfied - Satisfied)</option>','<option value="4">Pain scale (3 point)</option>'];if(d&&(r=u.name,h&&(n=u.name_l10n||""),(g=u.settings)&&g.hasOwnProperty("scale")&&(g=g.scale))){I[g-1]=I[g-1].replace('">','" selected>');
E=w[g];v+="<ul>";g=0;for(l=E.length;g<l;g++)v+="<li>"+E[g]+"</li>";v+="</ul>"}g=I.join();r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Likert-scale</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+r+'"></div></div>'+
C+G+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Choices</label><select id="scale-'+b+'"><option value="">Please choose scale</option>'+g+'</select></div></div><div class="row"><div class="columns medium-1"></div><div id="display-'+b+'" class="columns medium-11">'+v+"</div></div></div>";v='<div class="media content" id="translation-'+
c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Likert-scale</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><div class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+
n+'"></div></div></div>';H="#question-"+b+" input, #question-"+b+" select";n="#question-"+b+" .ucce-delete";break;case "heatmap":n=r="",d&&(r=u.name,h&&(n=u.name_l10n||"")),r='<div class="media content active" id="edit-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Heatmap</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><input id="name-'+
b+'"type="text" size=100 placeholder="type question" value="'+r+'"></div></div>'+C+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Image</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-6"><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><span id="preview-'+b+'" class="preview-empty fleft"></span></div><div class="columns medium-5"><h3>Number of clicks allowed:</h3><i class="ucce ucce-minus"> </i> 1 <i class="ucce ucce-plus"> </i><h3>Tap/click regions:</h3><a class="button tiny">Add region</a><input id="region-'+
c+'-1" type="text" placeholder="enter label" disabled></div></div></div>',v='<div class="media content" id="translation-'+c+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Heatmap</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+k+'</label></div><div class="columns medium-11"><div class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+
b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>',H="#question-"+b+" input",n="#question-"+b+" .ucce-delete"}m=m+r+p+v;m+="</div></div>";a("#survey-droppable-"+c).before(m);k=c+1;a("#survey-droppable-"+c).attr("id","survey-droppable-"+k);B[e]++;a("#section-break-"+A[e]+" > span").html("PAGE "+e+" ("+B[e]+" ELEMENTS)");var y=this.eventNamespace,x=this,O=function(){a(H).off("change"+y).on("change"+y,function(){if("instructions"==f){var d=this.id.split("-");
d=parseInt(d[d.length-1]);var c=x.data.layout[d];c.do.text=a("#do-"+d).val();c.say.text=a("#say-"+d).val();h&&(c.do.hasOwnProperty("10n")||(c.do.l10n={}),c.do.l10n[h]=a("#do-l10n-"+d).val(),c.say.hasOwnProperty("10n")||(c.say.l10n={}),c.say.l10n[h]=a("#say-l10n-"+d).val());x.saveLayout()}else x.saveQuestion(f,b)});if("instructions"!=f&&"heatmap"!=f)a("#pipe-"+b).on("change"+y,function(){var d=a(this).val();if(d){for(var c,e=0,g=q.length;e<g;e++)if(c=q[e],c.label==d){u.settings.pipeImage={id:c.id,
region:c.region};break}x.deleteImage(b)}else delete u.settings.pipeImage;x.saveQuestion(f,b)})};O();"instructions"!=f&&(d&&(e=u.file)&&t(S3.Ap.concat("/default/download/"+e),function(d){var c=t.scale(d,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(c);return d},{}),a("#image-delete-"+b).on("click"+y,function(){x.deleteImage(b)}),a("#image-"+b).fileupload({dataType:"json",dropZone:a("#preview-"+b+", #image-"+b),maxNumberOfFiles:1,url:S3.Ap.concat("/dc/question/")+
b+"/image_upload.json",add:function(d,c){if(d.isDefaultPrevented())return!1;(c.autoUpload||!1!==c.autoUpload&&a(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit();t(c.files[0],function(d){var c=t.scale(d,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(c);c=u.type;if(13!=c){u.settings.hasOwnProperty("pipeImage")&&a("#pipe-"+b).val("").trigger("change");var e=!1;for(d in q)d.id==b&&(e=!0);e||(c="Q"+a("#question-"+b).data("number")+
" "+J[c],q.push({label:c,id:b}));c=x.data.questions;e=x.data.layout;for(var f=1;f<=Object.keys(e).length;f++){var g=e[f];if("question"==g.type){g=g.id;var h=c[g];13!=h.type&&a("#pipe-"+g).empty().append(x.pipeOptionsHtml(g))}}}return d},{})})}}));a(n).on("click"+y,function(){x.deleteQuestion(f,b,this)});switch(f){case "number":a("#answer-"+b).validate({rules:{min:{required:!1,digits:!0,lessThanMax:!0},max:{required:!1,digits:!0,greaterThanMin:!0}},messages:{min:{digits:"Only integers allowed"},max:{digits:"Only integers allowed"}},
errorClass:"req",focusCleanup:!0});break;case "multichoice":var F=a("#multiple-"+b),z=a("#multiple-count-"+b),P=function(){a(".choice-"+b).next().off("click"+y).on("click"+y,function(){if(1<a(".choice-"+b).length){a(this).parent().remove();var d=parseInt(z.html()),c=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&c++;d>c&&(z.html(c),1==c&&F.prop("checked",!1));x.saveQuestion(f,b)}else a(this).prev().val("")});a(".choice-"+b).next().next().off("click"+y).on("click"+y,function(){a(this).parent().parent().after(L);
O();P()});a("#other-"+b).on("change"+y,function(){if(a(this).prop("checked"))a("#other-label-"+b).prop("disabled",!1);else{a("#other-label-"+b).prop("disabled",!0);var d=parseInt(z.html()),c=a(".choice-"+b).length;d>c&&(z.html(c),1==c&&F.prop("checked",!1))}});F.on("change"+y,function(){if(F.prop("checked")){parseInt(z.html());var d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;1<d?z.html(2):F.prop("checked",!1)}else z.html(1);x.saveQuestion(f,b)});z.prev().on("click"+y,function(){if(F.prop("checked")){var a=
parseInt(z.html());2<a?(z.html(a-1),x.saveQuestion(f,b)):2==a&&(z.html(1),F.prop("checked",!1),x.saveQuestion(f,b))}});z.next().on("click"+y,function(){if(F.prop("checked")){var d=parseInt(z.html()),c=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&c++;d<c&&(z.html(d+1),x.saveQuestion(f,b))}})};P();break;case "likert":a("#scale-"+b).on("change"+y,function(){var d=a(this).val();if(d){d=w[d];for(var c="",e=0,f=d.length;e<f;e++)c+="<li>"+d[e]+"</li>";d="<ul>"+c+"</ul>";a("#display-"+b).empty().append(d)}else a("#display-"+
b).empty()})}"instructions"==f?a("#instruction-"+c).foundation("tab","reflow"):a("#question-"+b).foundation("tab","reflow")},deleteQuestion:function(c,e,f){if("instructions"==c){f=parseInt(a(f).closest(".dl-item").attr("id").split("-")[1]);var b=a("#instruction-"+f).data("page")}else f=a("#question-"+e).data("number"),f=D[f],b=a("#question-"+e).data("page");B[b]--;a("#section-break-"+A[b]+" > span").html("PAGE "+b+" ("+B[b]+" ELEMENTS)");var d=b+1;for(b=Object.keys(A).length;d<=b;d++)A[d]--;var h,
g,l=this.data.layout,k=Object.keys(l).length;for(d=f;d<k;d++){b=d+1;var m=l[b];l[d]=m;if("break"==m.type)a("#section-break-"+b).attr("id","section-break-"+d);else{if("question"==m.type){var n=m.id;m=a("#question-"+n);var p=m.data("number");if("instructions"==c)D[p]=d;else{var q=p-1;m.data("number",q);a("#qlabel-"+n).html("Q"+q);a("#qlabel-l10n-"+n).html("Q"+q);D[q]=d}}else a("#instruction-"+b).attr("id","instruction-"+d),m=a("#instruction-"+d),a("#do-"+b).attr("id","do-"+d),a("#say-"+b).attr("id",
"say-"+d),a("#do-l10n-"+b).attr("id","do-l10n-"+d),a("#say-l10n-"+b).attr("id","say-l10n-"+d);a("#edit-"+b).attr("id","edit-"+d);a("#logic-"+b).attr("id","logic-"+d);a("#translation-"+b).attr("id","translation-"+d);m.find("li.tab-title > a").each(function(){var b=a(this);h=b.attr("href");g=h.split("-")[0];g=g.substring(1,g.length);b.attr("href","#"+g+"-"+d)})}}delete l[k];"instructions"!=c&&delete D[p];this.saveLayout();"instructions"==c?a("#instruction-"+f).remove():a("#question-"+e).remove();a("#survey-droppable-"+
(k+1)).attr("id","survey-droppable-"+k);"instructions"!=c&&(c=S3.Ap.concat("/dc/question/")+e+"/delete.json",this.ajaxMethod({url:c,type:"POST",dataType:"json",success:function(){},error:function(a,b,d){console.log("UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText)}}))},pipeOptionsHtml:function(a,e){var c=this.data.questions[a];e='<option value="">select question</option>';if(c&&c.settings&&c.settings.pipeImage)var b=c.settings.pipeImage;for(var d=0,h=q.length;d<h;d++)c=q[d],c.id!=a&&(e=b&&
b.id==c.id&&b.region==c.region?e+("<option selected>"+c.label+"</option>"):e+("<option>"+c.label+"</option>"));return e},logicOptionsHtml:function(a,e){return'<option value="">select question</option>'},deleteImage:function(c){var e=this,f=a("#preview-"+c);if(!f.hasClass("preview-empty")){var b=S3.Ap.concat("/dc/question/")+c+"/image_delete.json";this.ajaxMethod({url:b,type:"POST",dataType:"json",success:function(){f.empty().addClass("preview-empty");var b=q;q=[];for(var h=0,g=b.length;h<g;h++){var l=
b[h];l.id!=c&&q.push(l)}l=e.data.questions;b=e.data.layout;for(h=1;h<=Object.keys(b).length;h++)if(g=b[h],"question"==g.type){g=g.id;var k=l[g];13!=k.type&&a("#pipe-"+g).empty().append(e.pipeOptionsHtml(g))}},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},addSectionBreak:function(c,e,f){e++;A[e]=c;B[e]=0;var b='<div class="row"><div class="section-break medium-11 columns" id="section-break-'+c+'" data-page="'+e+'"><span>PAGE '+e+' (0 ELEMENTS)</span></div><div class="medium-1 columns">'+
(c?'<i class="ucce ucce-delete-page"> </i>':"")+'<i class="ucce ucce-down-alt"> </i></div></div>';if(c){a("#survey-droppable-"+c).before(b);b=c+1;a("#survey-droppable-"+c).data("page",e).attr("id","survey-droppable-"+b);f||(this.data.layout[c]={type:"break"},this.saveLayout());var d=this;e=this.eventNamespace;a("#section-break-"+c).next().children(".ucce-delete-page").on("click"+e,function(){var b=parseInt(a(this).parent().prev().attr("id").split("-")[2]);d.deleteSectionBreak(b)})}else a(this.element).parent().append(b)},
deleteSectionBreak:function(c){var e=a("#section-break-"+c).data("page"),f=B[e];if(f){var b=e-1;B[b]+=f;a("#section-break-"+A[b]+" > span").html("PAGE "+b+" ("+B[b]+" ELEMENTS)")}f=Object.keys(A).length;for(var d=e;d<f;d++)A[d]=A[d+1]-1,B[d]=B[d+1];delete A[f];delete B[f];e=this.data.layout;b=Object.keys(e).length;if(c!=b){var h,g;for(d=c;d<b;d++){var l=d+1;var k=e[l];e[d]=k;if("break"==k.type)k=a("#section-break-"+l).data("page")-1,a("#section-break-"+l).data("page",k),a("#section-break-"+l+" > span").html("PAGE "+
k+" ("+B[k]+" ELEMENTS)"),a("#section-break-"+l).attr("id","section-break-"+d);else{if("question"==k.type){var m=a("#question-"+k.id);k=m.data("number");D[k]=d}else a("#instruction-"+l).attr("id","instruction-"+d),m=a("#instruction-"+d),a("#do-"+l).attr("id","do-"+d),a("#say-"+l).attr("id","say-"+d),a("#do-l10n-"+l).attr("id","do-"+d),a("#say-l10n-"+l).attr("id","say-"+d);a("#edit-"+l).attr("id","edit-"+d);a("#logic-"+l).attr("id","logic-"+d);a("#translation-"+l).attr("id","translation-"+d);m.find("li.tab-title > a").each(function(){var b=
a(this);h=b.attr("href");g=h.split("-")[0];g=g.substring(1,g.length);b.attr("href","#"+g+"-"+d)})}}}delete e[b];this.saveLayout();a("#section-break-"+c).parent().remove();a("#survey-droppable-"+(b+1)).data("page",f-1).attr("id","survey-droppable-"+b)},droppable:function(c,e){var f=this;e='<div class="survey-droppable" id="survey-droppable-'+c+'" data-page="'+e+'"><span>Drag and drop questions here</span></div>';a(this.element).parent().append(e);a("#survey-droppable-"+c).droppable({drop:function(b,
c){b=c.draggable[0].id;c=parseInt(this.id.split("-")[2]);var d=a(this).data("page");"break"==b?f.addSectionBreak(c,d):f.addQuestion(c,d,b)}})},_destroy:function(){a.Widget.prototype.destroy.call(this)},loadSurvey:function(){var a=this.data.layout;if(a){for(var e,f=1,b=0,d,h,g,l=this.data.questions,k=Object.keys(a).length,m=1;m<=k;m++)if(e=a[m],"break"!=e.type&&"instructions"!=e.type&&(b++,D[b]=m,e=e.id,d=l[e],d.file))if(13==d.type){if(d=d.settings.regions){h="Q"+b+" Heatmap; ";for(var n=0,p=d.length;n<
p;n++)g=h+"'"+d[n].label+"'",q.push({label:g,id:e,region:n})}}else g="Q"+b+" "+J[d.type],q.push({label:g,id:e});for(m=1;m<=k;m++)e=a[m],"break"==e.type?(this.addSectionBreak(m,f,!0),f++):"instructions"==e.type?this.addQuestion(m,f,"instructions",!0):(e=e.id,this.addQuestion(m,f,J[l[e].type],e))}},refresh:function(){this._unbindEvents();this._deserialize();this.addSectionBreak(0,0);this.droppable(1,1);this.loadSurvey();this._bindEvents()},saveQuestion:function(c,e){var f=a("#name-"+e).val();if(f){var b=
S3.Ap.concat("/dc/question/")+e+"/update_json.json",d=this.data.l10n,h={};f={name:f,mandatory:a("#mandatory-"+e).prop("checked")};d&&(d=a("#name-l10n-"+e).val())&&(f.name_l10n=d);if(d=this.data.questions[e].settings.pipeImage)h.pipeImage=d;switch(c){case "number":a("#min-"+e).hasClass("req")?c=null:(c=a("#min-"+e).val())&&(c=parseInt(c));a("#max-"+e).hasClass("req")?e=null:(e=a("#max-"+e).val())&&(e=parseInt(e));h.requires={isIntInRange:{min:c,max:e}};break;case "multichoice":var g=[];a(".choice-"+
e).each(function(){g.push(a(this).val())});f.options=g;a("#other-"+e).prop("checked")?h.other=a("#other-label-"+e).val():h.other=null;a("#multiple-"+e).prop("checked")?h.multiple=parseInt(a("#multiple-count-"+e).html()):h.multiple=1;break;case "likert":(e=a("#scale-"+e).val())?(f.options=w[e],h.scale=e):(f.options=[],h.scale=null)}f.settings=h;this.ajaxMethod({url:b,type:"POST",data:JSON.stringify(f),dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:
a.responseText)}})}},saveLayout:function(){var a=S3.Ap.concat("/dc/template/")+this.recordID+"/update_json.json";this.ajaxMethod({url:a,type:"POST",data:JSON.stringify({layout:this.data.layout}),dataType:"json",success:function(){},error:function(a,c,b){console.log("UNAUTHORIZED"==b?i18n.gis_requires_login:a.responseText)}})},_deserialize:function(){var c=a(this.element).val()||"{}";return this.data=JSON.parse(c)},_bindEvents:function(){var c=this,e=this.eventNamespace,f=a("#survey-name");a(document).foundation({tab:{callback:function(b){if("Translation"==
b.text()){var c=b.children().first().attr("href").split("-")[1];b=b.closest(".dl-item").attr("id").split("-");"instruction"==b[0]?(a("#do-l10n-"+c).prev().html(a("#do-"+c).val()),a("#say-l10n-"+c).prev().html(a("#say-"+c).val())):(c=b[1],a("#name-l10n-"+c).parent().parent().prev().children(".medium-11").first().children(".translate-from").html(a("#name-"+c).val()))}}}});f.on("change"+e,function(){var a=f.val(),d=f.data("id");c.ajaxMethod({url:S3.Ap.concat("/dc/target/")+d+"/name.json",type:"POST",
data:JSON.stringify({name:a}),dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})});a("#survey-l10n").on("change"+e,function(){var b=a(this).val(),d=f.data("id");c.ajaxMethod({url:S3.Ap.concat("/dc/target/")+d+"/l10n.json",type:"POST",data:JSON.stringify({l10n:b}),dataType:"json",success:function(){(c.data.l10n=b)?(a("li.l10n").removeClass("hide").show(),a(document).foundation("tab","reflow")):a("li.l10n").hide()},error:function(a,
b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})});a(".draggable").draggable({revert:!0,revertDuration:250})},_unbindEvents:function(){var c=this.eventNamespace;a("#survey-name").unbind(c);a("#survey-l10n").unbind(c);c=a(".draggable");void 0!=c.draggable("instance")&&c.draggable("destroy");return!0}})});
