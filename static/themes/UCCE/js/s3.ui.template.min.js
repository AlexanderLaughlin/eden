var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var p=0;return function(){return p<a.length?{done:!1,value:a[p++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,p,h){a!=Array.prototype&&a!=Object.prototype&&(a[p]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,p){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:p})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(h){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(h||"")+"_"+p++,h)}var p=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,p){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var h=0,m={next:function(){if(h<a.length){var u=h++;return{value:p(u,a[u]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill=function(a,p,h,m){if(p){h=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var u=a[m];u in h||(h[u]={});h=h[u]}a=a[a.length-1];m=h[a];p=p(m);p!=m&&null!=p&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:p})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,p,h){a instanceof String&&(a=String(a));for(var m=a.length,u=0;u<m;u++){var z=a[u];if(p.call(h,z,u,a))return{i:u,v:z}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6","es3");
(function(a){a(window.jQuery,window.loadImage)})(function(a,p){var h=0,m=[],u={1:["Strongly Disagree","Disagree","Undecided","Agree","Strongly Agree"],2:["Very unsatisfied","Unsatisfied","Neutral","Satisfied","Very satisfied"],3:["Very dissatisfied","Dissatisfied","Neutral","Satisfied","Very satisfied"],4:["Pain","Neutral","No Pain"]},z={},A={},B={},M={text:1,number:2,multichoice:6,likert:12,heatmap:13},H={1:"text",2:"number",6:"multichoice",12:"likert",13:"heatmap"};a.widget("s3.surveyLayout",{options:{},
_create:function(){this.id=h;h+=1;this.eventNamespace=".surveyEditor"},_init:function(){var e=a(this.element),d=e.attr("id");d||(d="surveyEditor-widget-"+this.id);this.fieldname=d;this.recordID=e.data("id");this.data=null;this.ajaxMethod=void 0!==a.searchS3?a.searchS3:a.ajaxS3;a.validator.addMethod("lessThanMax",function(d,b){var c=b.id.split("-")[1];c=a("#max-"+c).val();return""==c?this.optional(b)||!0:this.optional(b)||parseFloat(d)<=c},"needs to be lower than Maximum");a.validator.addMethod("greaterThanMin",
function(d,b){var c=b.id.split("-")[1];c=a("#min-"+c).val();return""==c?this.optional(b)||!0:this.optional(b)||parseFloat(d)>=c},"needs to be higher than Minimum");this.refresh()},addQuestion:function(a,d,g,b){if("instructions"==g)b?this._addQuestion(a,d,g,null,!0):this._addQuestion(a,d,g);else if(b)this._addQuestion(a,d,g,b,!0);else{var c=this;b=S3.Ap.concat("/dc/question/create_json.json");var e=JSON.stringify({type:M[g],template_id:this.recordID});this.ajaxMethod({url:b,type:"POST",data:e,dataType:"json",
success:function(b){c._addQuestion(a,d,g,b.question_id)},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},_addQuestion:function(e,d,g,b,c){var l=this.data.l10n;if(c)for(var f=1,k=Object.keys(B).length;f<=k;f++){if(e==B[f]){var r=f;break}}else"instructions"==g?this.data.layout[e]={type:"instructions",do:{text:""},say:{text:""}}:(r=Object.keys(B).length+1,B[r]=e,this.data.layout[e]={type:"question",id:b},this.data.questions[b]={type:M[g],settings:{}}),
this.saveLayout();var v="",n;l||(v=" hide");var h='<li class="tab-title l10n'+v+'"><a href="#translation-'+e+'">Translation</a></li>';if("instructions"==g){var L="instruction-"+e;var G="";var N="#instruction-"+e+" input, #instruction-"+e+" select";v="#instruction-"+e+" .ucce-delete"}else{L="question-"+b;G=' data-number="'+r+'"';N="#question-"+b+" input, #question-"+b+" select";v="#question-"+b+" .ucce-delete";var C="";var t=this.data.questions[b];c&&t.mandatory&&(C=" checked");C='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="mandatory-'+
b+'" type="checkbox" '+C+' class="fleft"><label>Make question mandatory</label></div></div>';if("heatmap"!=g){var E=this.pipeOptionsHtml(b);E='<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Add image</label><span id="preview-'+b+'" class="preview-empty fleft"></span><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><label class="fleft">or pipe question image:</label><select id="pipe-'+
b+'" class="fleft">'+E+'</select><a id="image-delete-'+b+'">Delete</a></div></div>'}}G='<div class="thumbnail dl-item" id="'+L+'" data-page="'+d+'"'+G+'><div class="card-header"><ul class="tabs fleft" data-tab><li class="tab-title active"><a href="#edit-'+e+'">Edit</a></li><li class="tab-title"><a href="#logic-'+e+'">Display logic</a></li> '+h+'</ul><div class="edit-bar fright"><a><i class="ucce ucce-duplicate"> </i></a><a><i class="ucce ucce-delete"> </i></a><i class="ucce ucce-up"> </i><i class="ucce ucce-down"> </i></div></div><div class="tabs-content">';
L='<div class="media content" id="logic-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Only display question if...</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><select id="logic-select-'+e+'" class="fleft"></select><label class="fleft">response is</label></div></div></div>';switch(g){case "instructions":E=n=r=C="";if(c){var q=this.data.layout[e];C=q.do.text;n=q.say.text;l&&q.do.l10n&&
(r=q.do.l10n[l],E=q.say.l10n[l])}q='<div class="media content active" id="edit-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Data collector instructions</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>What instructor should do</label><input id="do-'+e+'" type="text" size=100 placeholder="Type what instructor should do" value="'+C+'"><label>What instructor should say</label><input id="say-'+
e+'" type="text" size=100 placeholder="Type what instructor should say" value="'+n+'"></div></div></div>';n='<div class="media content" id="translation-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Data collector instructions</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>What instructor should do</label><div class="translate-from"></div><input id="do-l10n-'+e+'" type="text" size=100 placeholder="Type translation..." value="'+
r+'"><label>What instructor should say</label><div class="translate-from"></div><input id="say-l10n-'+e+'" type="text" size=100 placeholder="Type translation..." value="'+E+'"></div></div></div>';break;case "text":n=q="";c&&(q=t.name,l&&(n=t.name_l10n||""));q='<div class="media content active" id="edit-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Text box</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+
b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><input id="name-'+b+'" type="text" size=100 placeholder="type question" value="'+q+'"></div></div>'+C+E+"</div>";n='<div class="media content" id="translation-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Text box</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><div id="name-l10n-from-'+
b+'" class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>';break;case "number":k=h=n=q="";c&&(q=t.name,l&&(n=t.name_l10n||""),f=t.settings||{},f=(f.requires||{}).isIntInRange)&&(h=f.min||"",k=f.max||"");q='<div class="media content active" id="edit-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Number question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+
b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+q+'"></div></div>'+C+E+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Restrict input to:</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><form id="answer-'+
b+'"><label class="fleft">Minimum:</label><input id="min-'+b+'" name="min" type="number" value="'+h+'" class="fleft"><label class="fleft">Maximum:</label><input id="max-'+b+'" name="max" type="number" value="'+k+'" class="fleft"></form></div></div></div>';n='<div class="media content" id="translation-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Number question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+
b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><div id="name-l10n-from-'+b+'" class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>';break;case "multichoice":var O='<div id="choice-row-'+b+'-0" class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input class="choice-'+
b+'" type="text" placeholder="Enter an answer choice"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div></div>';n=q="";k=O;var I=h="",P=" disabled",D="",J="";f=1;var Q="";if(c){q=t.name;l&&(n=t.name_l10n||"");D=t.options||[];J=t.options_l10n||[];var K=D.length;if(K)for(k="",f=0;f<K;f++){k+='<div id="choice-row-'+b+"-"+f+'" class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input class="choice-'+b+'" type="text" placeholder="Enter an answer choice" value="'+
D[f]+'"><i class="ucce ucce-minus"> </i><i class="ucce ucce-plus"> </i></div></div>';var T=J[f]||"";h+='<div id="choice-l10n-row-'+b+"-"+f+'" class="row"><div class="columns medium-1"></div><div class="columns medium-11"><div class="row"><div class="columns medium-6"><div id="choice-from-'+b+"-"+f+'" class="translate-from">'+D[f]+'</div></div><div class="columns medium-6"><input class="choice-l10n-'+b+'" type="text" placeholder="Type translation..." value="'+T+'"></div></div></div></div>'}f=t.settings;
J="";K=" hide";if(D=f.other||"")I=" checked",P="",J=f.otherL10n||"",K="";h+='<div id="other-l10n-row-'+b+'" class="row'+K+'"><div class="columns medium-1"></div><div class="columns medium-11"><div class="row"><div class="columns medium-6"><div id="other-l10n-from-'+b+'" class="translate-from">'+D+'</div></div><div class="columns medium-6"><input id="other-l10n-'+b+'" type="text" placeholder="Type translation..." value="'+J+'"></div></div></div></div>';f=f.multiple||1;1<f&&(Q=" checked")}q='<div class="media content active" id="edit-'+
e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Multiple choice question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+q+'"></div></div>'+C+E+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Choices</label></div></div>'+
k+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="other-'+b+'" type="checkbox"'+I+'><label>Add \'other field\'</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label class="fleft">Field label</label><input id="other-label-'+b+'" type="text" placeholder="Other (please specify)" value="'+D+'"'+P+'></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="multiple-'+
b+'" type="checkbox"'+Q+'><label>Allow multiple responses</label></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label class="fleft">Maximum No. of responses:</label><i class="ucce ucce-minus"> </i> <span id="multiple-count-'+b+'">'+f+'</span> <i class="ucce ucce-plus"> </i></div></div></div>';n='<div class="media content" id="translation-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Multiple choice question</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+
b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><div id="name-l10n-from-'+b+'" class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Answer</h2></div></div><div class="row" id="choices-l10n-row-'+
b+'"><div class="columns medium-1"></div><div class="columns medium-11"><label>Choices</label></div></div>'+h+"</div>";break;case "likert":h=n=q="";I=['<option value="1">Agreement (Disagree - Agree)</option>','<option value="2">Satisfaction (Smiley scale)</option>','<option value="3">Satisfaction (Dissatisfied - Satisfied)</option>','<option value="4">Pain scale (3 point)</option>'];if(c&&(q=t.name,l&&(n=t.name_l10n||""),(f=t.settings)&&f.hasOwnProperty("scale")&&(f=f.scale))){I[f-1]=I[f-1].replace('">',
'" selected>');D=u[f];h+="<ul>";f=0;for(k=D.length;f<k;f++)h+="<li>"+D[f]+"</li>";h+="</ul>"}f=I.join();q='<div class="media content active" id="edit-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Likert-scale</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+
q+'"></div></div>'+C+E+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Answer</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><label>Choices</label><select id="scale-'+b+'"><option value="">Please choose scale</option>'+f+'</select></div></div><div class="row"><div class="columns medium-1"></div><div id="display-'+b+'" class="columns medium-11">'+h+"</div></div></div>";n='<div class="media content" id="translation-'+
e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Likert-scale</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><div id="name-l10n-from-'+b+'" class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+b+'" type="text" size=100 placeholder="type translated question" value="'+
n+'"></div></div></div>';break;case "heatmap":J=n=q="",c&&(q=t.name,l&&(n=t.name_l10n||"")),q='<div class="media content active" id="edit-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Heatmap</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><input id="name-'+b+'"type="text" size=100 placeholder="type question" value="'+q+'"></div></div>'+
C+'<div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="fleft">Image</h2></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-6"><label for="image-'+b+'" class="button tiny fleft">Upload image</label><input id="image-'+b+'" name="file" type="file" accept="image/png, image/jpeg" class="show-for-sr"><span id="preview-'+b+'" class="preview-empty fleft"></span></div><div class="columns medium-5"><h3>Number of clicks allowed:</h3><i class="ucce ucce-minus"> </i> 1 <i class="ucce ucce-plus"> </i><h3>Tap/click regions:</h3><a class="button tiny">Add region</a><input id="region-'+
e+'-1" type="text" placeholder="enter label" disabled></div></div></div>',n='<div class="media content" id="translation-'+e+'"><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><h2 class="left">Heatmap</h2></div></div><div class="row"><div class="columns medium-1"><label id="qlabel-l10n-'+b+'" class="fright">Q'+r+'</label></div><div class="columns medium-11"><div id="name-l10n-from-'+b+'" class="translate-from"></div></div></div><div class="row"><div class="columns medium-1"></div><div class="columns medium-11"><input id="name-l10n-'+
b+'" type="text" size=100 placeholder="type translated question" value="'+n+'"></div></div></div>'}G=G+q+L+n;G+="</div></div>";a("#survey-droppable-"+e).before(G);r=e+1;a("#survey-droppable-"+e).attr("id","survey-droppable-"+r);A[d]++;a("#section-break-"+z[d]+" > span").html("PAGE "+d+" ("+A[d]+" ELEMENTS)");var x=this.eventNamespace,w=this,R=function(){a(N).off("change"+x).on("change"+x,function(){var c=this.id.split("-");if("logic"==c[0]){var d=a(this),e=d.val();c=parseInt(c[c.length-1]);a("#sub-logic-select-"+
c).remove();e&&(e=w.logicSubOptionsHtml(b,c,e),d.next().after(e))}else"instructions"==g?(c=parseInt(c[c.length-1]),d=w.data.layout[c],d.do.text=a("#do-"+c).val(),d.say.text=a("#say-"+c).val(),l&&(d.do.hasOwnProperty("10n")||(d.do.l10n={}),d.do.l10n[l]=a("#do-l10n-"+c).val(),d.say.hasOwnProperty("10n")||(d.say.l10n={}),d.say.l10n[l]=a("#say-l10n-"+c).val()),w.saveLayout()):w.saveQuestion(g,b)});if("instructions"!=g&&"heatmap"!=g)a("#pipe-"+b).on("change"+x,function(){var c=a(this).val();if(c){for(var d,
e=0,f=m.length;e<f;e++)if(d=m[e],d.label==c){t.settings.pipeImage={id:d.id,region:d.region};break}w.deleteImage(b)}else delete t.settings.pipeImage;w.saveQuestion(g,b)})};R();"instructions"!=g&&(c&&(d=t.file)&&p(S3.Ap.concat("/default/download/"+d),function(c){var d=p.scale(c,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(d);return c},{}),a("#image-delete-"+b).on("click"+x,function(){w.deleteImage(b)}),a("#image-"+b).fileupload({dataType:"json",
dropZone:a("#preview-"+b+", #image-"+b),maxNumberOfFiles:1,url:S3.Ap.concat("/dc/question/")+b+"/image_upload.json",add:function(c,d){if(c.isDefaultPrevented())return!1;(d.autoUpload||!1!==d.autoUpload&&a(this).fileupload("option","autoUpload"))&&d.process().done(function(){d.submit();p(d.files[0],function(c){var d=p.scale(c,{canvas:!0,maxHeight:80,maxWidth:80});a("#preview-"+b).removeClass("preview-empty").empty().append(d);d=t.type;if(13!=d){t.settings.hasOwnProperty("pipeImage")&&a("#pipe-"+b).val("").trigger("change");
var e=!1;for(c in m)c.id==b&&(e=!0);e||(d="Q"+a("#question-"+b).data("number")+" "+H[d],m.push({label:d,id:b}));d=w.data.questions;e=w.data.layout;for(var f=1;f<=Object.keys(e).length;f++){var g=e[f];if("question"==g.type){g=g.id;var l=d[g];13!=l.type&&a("#pipe-"+g).empty().append(w.pipeOptionsHtml(g))}}}return c},{})})}}));a(v).on("click"+x,function(){w.deleteQuestion(g,b,this)});switch(g){case "number":a("#answer-"+b).validate({rules:{min:{required:!1,digits:!0,lessThanMax:!0},max:{required:!1,
digits:!0,greaterThanMin:!0}},messages:{min:{digits:"Only integers allowed"},max:{digits:"Only integers allowed"}},errorClass:"req",focusCleanup:!0});break;case "multichoice":var F=a("#multiple-"+b),y=a("#multiple-count-"+b),S=function(){a(".choice-"+b).next().off("click"+x).on("click"+x,function(){if(1<a(".choice-"+b).length){var c=a(this).closest(".row"),d=parseInt(c.attr("id").split("-")[3]);c.remove();a("#choice-l10n-row-"+b+"-"+d).remove();c=a(".choice-"+b).length;for(var e=d+1;e<=c;e++)d=e-
1,a("#choice-row-"+b+"-"+e).attr("id","choice-row-"+b+"-"+d),a("#choice-l10n-row-"+b+"-"+e).attr("id","choice-l10n-row-"+b+"-"+d),a("#choice-from-"+b+"-"+e).attr("id","choice-from-"+b+"-"+d);d=parseInt(y.html());a("#other-"+b).prop("checked")&&c++;d>c&&(y.html(c),1==c&&F.prop("checked",!1));w.saveQuestion(g,b)}else a(this).prev().val("")});a(".choice-"+b).next().next().off("click"+x).on("click"+x,function(){for(var c=a(this).closest(".row"),d=parseInt(c.attr("id").split("-")[3]),e,f=a(".choice-"+
b).length-1;f>d;f--)e=f+1,a("#choice-row-"+b+"-"+f).attr("id","choice-row-"+b+"-"+e),a("#choice-l10n-row-"+b+"-"+f).attr("id","choice-l10n-row-"+b+"-"+e),a("#choice-from-"+b+"-"+f).attr("id","choice-from-"+b+"-"+e);e=d+1;c.after(O.replace("-0","-"+e));a("#choice-l10n-row-"+b+"-"+d).after('<div id="choice-l10n-row-'+b+"-"+e+'" class="row"><div class="columns medium-1"></div><div class="columns medium-11"><div class="row"><div class="columns medium-6"><div id="choice-from-'+b+"-"+e+'" class="translate-from"></div></div><div class="columns medium-6"><input class="choice-l10n-'+
b+'" type="text" placeholder="Type translation..."></div></div></div></div>');R();S()});a("#other-"+b).on("change"+x,function(){if(a(this).prop("checked"))a("#other-label-"+b).prop("disabled",!1),a("#other-l10n-row-"+b).removeClass("hide").show();else{a("#other-label-"+b).prop("disabled",!0);a("#other-l10n-row-"+b).hide();var c=parseInt(y.html()),d=a(".choice-"+b).length;c>d&&(y.html(d),1==d&&F.prop("checked",!1))}});F.on("change"+x,function(){if(F.prop("checked")){parseInt(y.html());var c=a(".choice-"+
b).length;a("#other-"+b).prop("checked")&&c++;1<c?y.html(2):F.prop("checked",!1)}else y.html(1);w.saveQuestion(g,b)});y.prev().on("click"+x,function(){if(F.prop("checked")){var a=parseInt(y.html());2<a?(y.html(a-1),w.saveQuestion(g,b)):2==a&&(y.html(1),F.prop("checked",!1),w.saveQuestion(g,b))}});y.next().on("click"+x,function(){if(F.prop("checked")){var c=parseInt(y.html()),d=a(".choice-"+b).length;a("#other-"+b).prop("checked")&&d++;c<d&&(y.html(c+1),w.saveQuestion(g,b))}})};S();break;case "likert":a("#scale-"+
b).on("change"+x,function(){var c=a(this).val();if(c){c=u[c];for(var d="",e=0,f=c.length;e<f;e++)d+="<li>"+c[e]+"</li>";c="<ul>"+d+"</ul>";a("#display-"+b).empty().append(c)}else a("#display-"+b).empty()})}"instructions"==g?a("#instruction-"+e).foundation("tab","reflow"):a("#question-"+b).foundation("tab","reflow")},deleteQuestion:function(e,d,g){if("instructions"==e){g=parseInt(a(g).closest(".dl-item").attr("id").split("-")[1]);var b=a("#instruction-"+g).data("page")}else g=a("#question-"+d).data("number"),
g=B[g],b=a("#question-"+d).data("page");A[b]--;a("#section-break-"+z[b]+" > span").html("PAGE "+b+" ("+A[b]+" ELEMENTS)");var c=b+1;for(b=Object.keys(z).length;c<=b;c++)z[c]--;var l,f,k=this.data.layout,r=Object.keys(k).length;for(c=g;c<r;c++){b=c+1;var h=k[b];k[c]=h;if("break"==h.type)a("#section-break-"+b).attr("id","section-break-"+c);else{if("question"==h.type){var n=h.id;h=a("#question-"+n);var m=h.data("number");if("instructions"==e)B[m]=c;else{var p=m-1;h.data("number",p);a("#qlabel-"+n).html("Q"+
p);a("#qlabel-l10n-"+n).html("Q"+p);B[p]=c}}else a("#instruction-"+b).attr("id","instruction-"+c),h=a("#instruction-"+c),a("#do-"+b).attr("id","do-"+c),a("#say-"+b).attr("id","say-"+c),a("#do-l10n-"+b).attr("id","do-l10n-"+c),a("#say-l10n-"+b).attr("id","say-l10n-"+c);a("#edit-"+b).attr("id","edit-"+c);a("#logic-"+b).attr("id","logic-"+c);a("#translation-"+b).attr("id","translation-"+c);h.find("li.tab-title > a").each(function(){var b=a(this);l=b.attr("href");f=l.split("-")[0];f=f.substring(1,f.length);
b.attr("href","#"+f+"-"+c)})}}delete k[r];"instructions"!=e&&delete B[m];this.saveLayout();"instructions"==e?a("#instruction-"+g).remove():a("#question-"+d).remove();a("#survey-droppable-"+(r+1)).attr("id","survey-droppable-"+r);"instructions"!=e&&(e=S3.Ap.concat("/dc/question/")+d+"/delete.json",this.ajaxMethod({url:e,type:"POST",dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}}))},pipeOptionsHtml:function(a){var d=
this.data.questions[a];var e='<option value="">select question</option>';if(d&&d.settings&&d.settings.pipeImage)var b=d.settings.pipeImage;for(var c=0,l=m.length;c<l;c++)d=m[c],d.id!=a&&(e=b&&b.id==d.id&&b.region==d.region?e+("<option selected>"+d.label+"</option>"):e+("<option>"+d.label+"</option>"));return e},logicOptionsHtml:function(a,d){d='<option value="">select question</option>';for(var e=this.data.questions,b=this.data.layout,c,l,f,k=1,h=Object.keys(B).length;k<=h;k++)if(l=B[k],l=b[l].id,
l!=a&&(f=e[l],c=H[f.type],"number"==c||"multichoice"==c||"likert"==c||"heatmap"==c))c="Q"+k+": ",f=f.name,f=53<f.length?f.substring(0,50)+"...":f,c+=f,d+='<option value="'+l+'">'+c+"</option>";return d},logicSubOptionsHtml:function(a,d,g){a=this.data.questions[g];g=H[a.type];if("heatmap"==g)var b="region";else{if("number"==g)return"";b="option"}g=a.options;d='<select id="sub-logic-select-'+d+'"><option value="">select '+b+"</option>";for(var c=0,e=g.length;c<e;c++)b=g[c],d+='<option value="'+b+'">'+
b+"</option>";(a=a.settings.other)&&(d+='<option value="_other">'+a+"</option>");return d+"</select>"},deleteImage:function(e){var d=this,g=a("#preview-"+e);if(!g.hasClass("preview-empty")){var b=S3.Ap.concat("/dc/question/")+e+"/image_delete.json";this.ajaxMethod({url:b,type:"POST",dataType:"json",success:function(){g.empty().addClass("preview-empty");var b=m;m=[];for(var l=0,f=b.length;l<f;l++){var k=b[l];k.id!=e&&m.push(k)}k=d.data.questions;b=d.data.layout;for(l=1;l<=Object.keys(b).length;l++)if(f=
b[l],"question"==f.type){f=f.id;var h=k[f];13!=h.type&&a("#pipe-"+f).empty().append(d.pipeOptionsHtml(f))}},error:function(a,b,d){console.log("UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText)}})}},addSectionBreak:function(e,d,g){d++;z[d]=e;A[d]=0;var b='<div class="row"><div class="section-break medium-11 columns" id="section-break-'+e+'" data-page="'+d+'"><span>PAGE '+d+' (0 ELEMENTS)</span></div><div class="medium-1 columns">'+(e?'<i class="ucce ucce-delete-page"> </i>':"")+'<i class="ucce ucce-down-alt"> </i></div></div>';
if(e){a("#survey-droppable-"+e).before(b);b=e+1;a("#survey-droppable-"+e).data("page",d).attr("id","survey-droppable-"+b);g||(this.data.layout[e]={type:"break"},this.saveLayout());var c=this;d=this.eventNamespace;a("#section-break-"+e).next().children(".ucce-delete-page").on("click"+d,function(){var b=parseInt(a(this).parent().prev().attr("id").split("-")[2]);c.deleteSectionBreak(b)})}else a(this.element).parent().append(b)},deleteSectionBreak:function(e){var d=a("#section-break-"+e).data("page"),
g=A[d];if(g){var b=d-1;A[b]+=g;a("#section-break-"+z[b]+" > span").html("PAGE "+b+" ("+A[b]+" ELEMENTS)")}g=Object.keys(z).length;for(var c=d;c<g;c++)z[c]=z[c+1]-1,A[c]=A[c+1];delete z[g];delete A[g];d=this.data.layout;b=Object.keys(d).length;if(e!=b){var l,f;for(c=e;c<b;c++){var k=c+1;var h=d[k];d[c]=h;if("break"==h.type)h=a("#section-break-"+k).data("page")-1,a("#section-break-"+k).data("page",h),a("#section-break-"+k+" > span").html("PAGE "+h+" ("+A[h]+" ELEMENTS)"),a("#section-break-"+k).attr("id",
"section-break-"+c);else{if("question"==h.type){var m=a("#question-"+h.id);h=m.data("number");B[h]=c}else a("#instruction-"+k).attr("id","instruction-"+c),m=a("#instruction-"+c),a("#do-"+k).attr("id","do-"+c),a("#say-"+k).attr("id","say-"+c),a("#do-l10n-"+k).attr("id","do-"+c),a("#say-l10n-"+k).attr("id","say-"+c);a("#edit-"+k).attr("id","edit-"+c);a("#logic-"+k).attr("id","logic-"+c);a("#translation-"+k).attr("id","translation-"+c);m.find("li.tab-title > a").each(function(){var b=a(this);l=b.attr("href");
f=l.split("-")[0];f=f.substring(1,f.length);b.attr("href","#"+f+"-"+c)})}}}delete d[b];this.saveLayout();a("#section-break-"+e).parent().remove();a("#survey-droppable-"+(b+1)).data("page",g-1).attr("id","survey-droppable-"+b)},droppable:function(e,d){var g=this;d='<div class="survey-droppable" id="survey-droppable-'+e+'" data-page="'+d+'"><span>Drag and drop questions here</span></div>';a(this.element).parent().append(d);a("#survey-droppable-"+e).droppable({drop:function(b,c){b=c.draggable[0].id;
c=parseInt(this.id.split("-")[2]);var d=a(this).data("page");"break"==b?g.addSectionBreak(c,d):g.addQuestion(c,d,b)}})},_destroy:function(){a.Widget.prototype.destroy.call(this)},loadSurvey:function(){var a=this.data.layout;if(a){for(var d,g=1,b=0,c,l,f,h=this.data.questions,p=Object.keys(a).length,v=1;v<=p;v++)if(d=a[v],"break"!=d.type&&"instructions"!=d.type&&(b++,B[b]=v,d=d.id,c=h[d],c.file))if(13==c.type){if(c=c.settings.regions){l="Q"+b+" Heatmap; ";for(var n=0,u=c.length;n<u;n++)f=l+"'"+c[n].label+
"'",m.push({label:f,id:d,region:n})}}else f="Q"+b+" "+H[c.type],m.push({label:f,id:d});for(v=1;v<=p;v++)d=a[v],"break"==d.type?(this.addSectionBreak(v,g,!0),g++):"instructions"==d.type?this.addQuestion(v,g,"instructions",!0):(d=d.id,this.addQuestion(v,g,H[h[d].type],d))}},refresh:function(){this._unbindEvents();this._deserialize();this.addSectionBreak(0,0);this.droppable(1,1);this.loadSurvey();this._bindEvents()},saveQuestion:function(e,d){var g=a("#name-"+d).val();if(g){var b=S3.Ap.concat("/dc/question/")+
d+"/update_json.json",c=this.data.l10n,h={};g={name:g,mandatory:a("#mandatory-"+d).prop("checked")};if(c){var f=a("#name-l10n-"+d).val();f&&(g.name_l10n=f)}if(f=this.data.questions[d].settings.pipeImage)h.pipeImage=f;switch(e){case "number":a("#min-"+d).hasClass("req")?e=null:(e=a("#min-"+d).val())&&(e=parseInt(e));a("#max-"+d).hasClass("req")?d=null:(d=a("#max-"+d).val())&&(d=parseInt(d));h.requires={isIntInRange:{min:e,max:d}};break;case "multichoice":var k=[];a(".choice-"+d).each(function(){k.push(a(this).val())});
g.options=k;if(c){var m=[];a(".choice-l10n-"+d).each(function(){m.push(a(this).val())});g.options_l10n=m}a("#other-"+d).prop("checked")?(h.other=a("#other-label-"+d).val(),c&&(h.otherL10n=a("#other-l10n-"+d).val())):(h.other=null,c&&(h.otherL10n=null));a("#multiple-"+d).prop("checked")?h.multiple=parseInt(a("#multiple-count-"+d).html()):h.multiple=1;break;case "likert":(d=a("#scale-"+d).val())?(g.options=u[d],h.scale=d):(g.options=[],h.scale=null)}g.settings=h;this.ajaxMethod({url:b,type:"POST",data:JSON.stringify(g),
dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})}},saveLayout:function(){var a=S3.Ap.concat("/dc/template/")+this.recordID+"/update_json.json";this.ajaxMethod({url:a,type:"POST",data:JSON.stringify({layout:this.data.layout}),dataType:"json",success:function(){},error:function(a,e,b){console.log("UNAUTHORIZED"==b?i18n.gis_requires_login:a.responseText)}})},_deserialize:function(){var e=a(this.element).val()||"{}";return this.data=
JSON.parse(e)},_bindEvents:function(){var e=this,d=this.eventNamespace,g=a("#survey-name");a(document).foundation({tab:{callback:function(b){var c=b.text();if("Display logic"==c){c=b.children().first().attr("href").split("-")[1];b=b.closest(".dl-item").attr("id").split("-");var d=b[0];if("instruction"==d)a("#logic-select-"+c).html(e.logicOptionsHtml(null,c));else{var f=b[1];a("#logic-select-"+c).html(e.logicOptionsHtml(f,c))}}else if("Translation"==c)if(c=b.children().first().attr("href").split("-")[1],
b=b.closest(".dl-item").attr("id").split("-"),d=b[0],"instruction"==d)a("#do-l10n-"+c).prev().html(a("#do-"+c).val()),a("#say-l10n-"+c).prev().html(a("#say-"+c).val());else switch(f=b[1],c=e.data.questions[f],a("#name-l10n-from-"+f).html(a("#name-"+f).val()),d=H[c.type],d){case "multichoice":a(".choice-"+f).each(function(b){a("#choice-from-"+f+"-"+b).html(a(this).val())}),a("#other-l10n-from-"+f).html(a("#other-label-"+f).val())}}}});g.on("change"+d,function(){var a=g.val(),c=g.data("id");e.ajaxMethod({url:S3.Ap.concat("/dc/target/")+
c+"/name.json",type:"POST",data:JSON.stringify({name:a}),dataType:"json",success:function(){},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})});a("#survey-l10n").on("change"+d,function(){var b=a(this).val(),c=g.data("id");e.ajaxMethod({url:S3.Ap.concat("/dc/target/")+c+"/l10n.json",type:"POST",data:JSON.stringify({l10n:b}),dataType:"json",success:function(){(e.data.l10n=b)?(a("li.l10n").removeClass("hide").show(),a(document).foundation("tab","reflow")):
a("li.l10n").hide()},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})});a(".draggable").draggable({revert:!0,revertDuration:250})},_unbindEvents:function(){var e=this.eventNamespace;a("#survey-name").unbind(e);a("#survey-l10n").unbind(e);e=a(".draggable");void 0!=e.draggable("instance")&&e.draggable("destroy");return!0}})});
