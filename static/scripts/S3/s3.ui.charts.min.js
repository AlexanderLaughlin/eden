/*
 2018 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
(function(e,h){var g=0;e.widget("s3.uiChart",{options:{height:"280px",colors:null,transition:50,staggerLabels:!0,valueFormat:",.0f"},_create:function(){this.id=g;g+=1;this.eventNamespace=".uiChart"},_init:function(){this.refresh()},_destroy:function(){e.Widget.prototype.destroy.call(this)},refresh:function(){var d=e(this.element),a=this.options;this._unbindEvents();d.empty().css({height:a.height});a=d3.select(d.get(0)).append("svg").attr("class","nv");switch(d.data("type")){case "piechart":this._pieChart(a);
break;case "barchart":this._barChart(a);break;case "multibarchart":this._multiBarChart(a)}this._bindEvents()},_getData:function(d){var a=e(this.element).data("source");a&&e.ajaxS3({url:a,dataType:"json",type:"GET",ignoreStatus:[404],success:function(a){d(a)},error:function(a,b,f){d([]);console.log("UNAUTHORIZED"==f?i18n.gis_requires_login:a.responseText)}})},_barChart:function(d){var a=this.options,c=nv.models.discreteBarChart().duration(a.transition).x(function(a){return a.label}).y(function(a){return a.value}).staggerLabels(a.staggerLabels).showValues(!0);
a.colors&&c.color(a.colors);a=d3.format(a.valueFormat);c.yAxis.tickFormat(a);c.valueFormat(a);var b=this;nv.addGraph(function(){b._getData(function(a){d.datum(a).call(c);c.update()});nv.utils.windowResize(c.update)});return c},_multiBarChart:function(d){var a=e(this.element),c=this.options,b=nv.models.multiBarChart().duration(c.transition).x(function(a){return a.label}).y(function(a){return a.value}).reduceXTicks(!1).staggerLabels(c.staggerLabels).stacked(!0).groupSpacing(.1);"off"==a.data("controls")&&
b.showControls(!1);"off"==a.data("legend")&&b.showLegend(!1);a=d3.format(c.valueFormat);b.yAxis.tickFormat(a);c.colors&&b.color(c.colors);var f=this;nv.addGraph(function(){f._getData(function(a){d.datum(a).call(b);b.update()});nv.utils.windowResize(b.update)});return b},_pieChart:function(d){var a=e(this.element),c=this.options,b=nv.models.pieChart().duration(c.transition).x(function(a){return a.label}).y(function(a){return a.value}).showLabels(!0).showTooltipPercent(!0),f=d3.format(c.valueFormat);
b.valueFormat(f);"off"==a.data("legend")&&b.showLegend(!1);c.colors&&b.color(c.colors);var g=this;nv.addGraph(function(){g._getData(function(a){d.datum(a).call(b);b.update()});nv.utils.windowResize(b.update)});return b},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
