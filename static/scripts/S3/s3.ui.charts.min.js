/*
 2018 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
(function(d,g){var f=0;d.widget("s3.uiChart",{options:{height:"280px",colors:null,transition:50},_create:function(){d(this.element);this.id=f;f+=1;this.eventNamespace=".uiChart"},_init:function(){d(this.element);this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},refresh:function(){var c=d(this.element),b=this.options;this._unbindEvents();c.empty().css({height:b.height});var a=d3.select(c.get(0)).append("svg").attr("class","nv");switch(c.data("type")){case "piechart":var e=
this._pieChart(a);break;case "barchart":e=this._barChart(a);break;case "multibarchart":e=this._multiBarChart(a)}e&&this._getData(function(b){a.datum(b).call(e);e.update()});this._bindEvents()},_getData:function(c){var b=d(this.element).data("source");b&&d.ajaxS3({url:b,dataType:"json",type:"GET",success:function(a){c(a)},error:function(a,b,c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)}})},_barChart:function(c){d(this.element);var b=this.options,a=nv.models.discreteBarChart().duration(b.transition).x(function(a){return a.label}).y(function(a){return a.value}).staggerLabels(!0).showValues(!0);
b.colors&&a.color(b.colors);nv.addGraph(function(){c.call(a);nv.utils.windowResize(a.update)});return a},_multiBarChart:function(c){d(this.element);var b=this.options,a=nv.models.multiBarChart().duration(b.transition).x(function(a){return a.label}).y(function(a){return a.value}).reduceXTicks(!1).rotateLabels(0).showControls(!1).stacked(!0).groupSpacing(.1);b.colors&&a.color(b.colors);nv.addGraph(function(){c.call(a);nv.utils.windowResize(a.update)});return a},_pieChart:function(c){d(this.element);
var b=this.options,a=nv.models.pieChart().duration(b.transition).x(function(a){return a.label}).y(function(a){return a.value}).showLabels(!0);b.colors&&a.color(b.colors);nv.addGraph(function(){c.datum([]).call(a);nv.utils.windowResize(a.update)});return a},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
